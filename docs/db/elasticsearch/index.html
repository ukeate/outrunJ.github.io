<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  介绍
  #

分布式实时lucene


  使用
  #

./bin/elasticsearch
curl http://localhost:9200


  命令
  #

elasticsearch -Ecluster.name=my_cluster_name -Enode.name=my_node_name


  概念存储
  #

index
    type
        # document中加_type field实现
        # 所以不同type中的field在index要唯一，否则冲突
        # 对field排序会载入所有type的document
        document
            # 对应lucene中的key value倒排文档
            # 对就一个请求的json对象
            field
                mapping
                    # 定义type的field，映射json到document field


  设置
  #

config/elasticsearch.yml
    action.auto_create_index: -l*, &#43;z*
        # 自动创建，以z开头和非l开头的索引
    action.destructive_requires_name: true
        # 允许通配删index
    http.cors.enables: true
    http.cors.allow-origin: &quot;*&quot;
    cluster.name: c1
    node.name: n1
    node.master: true
    node.data: true
    transport.host: localhost
    transport.tcp.port: 9300
    network.host: 0.0.0.0
        # 修改es监听地址，别的机器也可以访问。同时设置bind_host和publish_host
        # 需要设置transport.host:localhost
    network.bind_host
        # 节点绑定ip
    network.publish_host
        # 发布地址，其它节点通过这个地址通信
    http.port: 9200
    transport.tcp.port
        # 通信端口，默认9300
    discovery.zen.minimum_master_nodes: 2

o-&gt; 可用配置
cluster.name: myES_Cluster
node.name: ESNODE_CYR
node.master: true
node.data: true
transport.host: localhost
transport.tcp.port: 9300
http.port: 9200
network.host: 0.0.0.0
discovery.zen.minimum_master_nodes: 2


  接口
  #


  index
  #

get/put/delete /index1              # 创建index, get查询，delete删除
    settings
    mappings
    aliases:
put /index1/_mapping/type2
get/put /index1/type2/_mapping      # 创建type或给已有type加mappings
    properties
put /index1/_settings
get/put /index1/type1/1             # 插入doc
    name: &quot;name1&quot;


  _cat
  #

get /_cat/health?v                  # 集群健康
get /_cat/nodes?v                   # 集群节点
get /_cat/indices?v                 # 所有索引


  _cluster
  #

get /_cluster/state?pretty          # 集群状态


  _aliases
  #

post /_aliases                      # 索引别名
    actions:
        add:
            alias: &quot;my_index&quot;
            index: &quot;my_index_v1&quot;
        remove


  _template
  #

put /_template/tpl1
    template: &quot;te*&quot;
        # 匹配所有re开头的index
    settings:
    mappings:


  _search
  #

post /index1/type1/_search
    # from size实时分页
    # scroll快照分页
    ?from=0&amp;size=50
    ?scroll=1m&amp;size=50
        # 过期时间1分钟，每次返回50条
    ?search_type=scan&amp;scroll=1m
        # scroll-scan分页不排序，更快,


  _analyze
  #

post /index1/_analyze
    text: &quot;刘德华&quot;
    analyzer: &quot;analyzer1&quot;


  _close
  #

post /index1/_close
    # 关闭索引，此后可以改settings


  _open
  #

post /index1/_open


  _cache
  #

post /index1/type1/_cache/clear?filter_keys=k1
    # 清空query filter的缓存


  数据对象
  #


  _search
  #

query
    match
        # 理解如何分词的, 会对field分词再查询
        field1:
            query: &quot;a b&quot;
            operator: &quot;and&quot;
            minimum_should_match: &quot;75%&quot;
                # 匹配的query分词的最低占比
    match_all
        # 默认，会查出所有文档
    multi_match
        query: &quot;a b&quot;
        fields: [&quot;field1&quot;, &quot;field2&quot;]
    match_phrase
        # 所有term命中，并且位置邻接
        field1: &quot;a b&quot;
    term
        # 确切查询
        field1: &quot;value1&quot;
    terms
        # 多条件and
        field1: [1,2,3]
    range
        field1:
            gt: 20
            gte:
            lt:
            lte:
    exists:
        field: &quot;field1&quot;
    missing:
        field: &quot;field1&quot;
    regexp
        postcode: &quot;W[0-9].&#43;&quot;
    wildcard
        postcode: &quot;W?F*HW&quot;
    prefix
        # 以某些字符开头
        field1: &quot;a&quot;
    bool
        # 分值计算来自must和should语句, must_not不影响
        must
            match
        must_not
        should: []
        minimum_should_match: 2
    filtered
        query
        filter:
            # filter的field会缓存起来
            ## geo, and, or, not, script, numeric_range的默认不缓存
            term:
                field1: &quot;a&quot;
                _cache_key: &quot;k1&quot;
                _cache: false
            range:
                field1:
                    gte: 0
aggs
    diy1:
        avg:
            field: &quot;field1&quot;
    diy2:
        terms:
            # 聚合查询中的所有term
            field: &quot;field1&quot;
post_filter:
    # 对搜索结果进行过滤
    term:
        field1: &quot;a&quot;
sort: []
    # 默认升序，_score默认降序
    field1
        order: &quot;desc&quot;
            # asc
        mode: &quot;min&quot;
            # 对数组元素排序时的取值, 还有max, sum, avg, median
        missing: &quot;field1&quot;
    &quot;_score&quot;,
highlight
    pre_tags: [&quot;&lt;tag1&gt;&quot;]
    post_tags: [&quot;&lt;/tag1&gt;&quot;]
    fields:
        content: {}
simple_query_string:
    query: &quot;&quot;
    analyzer:
    fields: [&quot;body^5&quot;, &quot;_all&quot;]
    default_operator: &quot;and&quot;


  mappings
  #

type1:
    dynamic: true
        # 默认true,自动给未知field建索引
        # false: 忽略未知field， strict: 未知field报错
    include_in_all: false
        # 默认不include
    _all:
        # meta field
        enabled: false
                # 关闭all作用域
        analyzer:
                # 其实是search_analyzer
        term_vector: no
                # 对field建立词频向量空间
        store: &quot;false&quot;
    _source:
        #  是否保存内容
        enabled: true
    properties:
        field1:
            type: “text”
                # text分词，keyword不分词，numeric, date, string
                # multi_field可定义多个field
            fields:[]
                field1:
                    type
            store: &quot;yes&quot;
            index: &quot;not_analyzed&quot;
                # analyzed
            analyzer: &quot;ik_max_word&quot;
            search_analyzer: &quot;ik_max_word&quot;
                # 默认为analyzer
            include_in_all: &quot;true&quot;
                # 是否加入_all作用域
            boost: 8


  aliases
  #

alias1:
    filter:
        term: user: &quot;kimchy&quot;
    routing: &quot;kimchy&quot;


  settings
  #

# 有些设置不能动态修改
index:
    number_of_shards: 3
    number_of_replicas: 2
    max_result_window: 10000
        # from &#43; size的上限，默认10000
    analysis:
        tokenizer:
            # 处理原始输入
            tokenizer1
                type: &quot;pinyin&quot;
                pinyin_field1:
        filter:
            # tokenizer作为输入
            filter1:
                type: &quot;pinyin&quot;
                pinyin_field1:
        analyzer:
            # 组合tokenizer和filter
            analyzer1:
                type: &quot;custom&quot;
                tokenizer: &quot;ik_smart&quot;
                filter: [&quot;filter1&quot;, &quot;word_delimiter&quot;]


  插件
  #

使用
    复制到/plugins
    场景中，指定type:&quot;xx&quot;使用
## ik
    介绍
        elasticsearch-analysis-ik
    安装
        mvn package
        unzip -d /elasticsearch/plugins/ik ./target/releases/elasticsearch-analysis-ik-1.8.0.zip
        重启elasticsearch
    分词器
        ik_max_word
            curl -XGET &#39;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_max_word&#39; -d &#39;联想是全球最大的笔记本厂商&#39;
        ik_smart
            curl -XGET &#39;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_smart&#39; -d &#39;联想是全球最大的笔记本厂商&#39;
    mapping type
        {
        &quot;properties&quot;: {
            &quot;content&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;store&quot;: &quot;no&quot;,
            &quot;term_vector&quot;: &quot;with_positions_offsets&quot;,
            &quot;analyzer&quot;: &quot;ik_smart&quot;,
            &quot;search_analyzer&quot;: &quot;ik_smart&quot;,
            &quot;include_in_all&quot;: &quot;true&quot;,
            &quot;boost&quot;: 8
            }
        }
        }
## pinyin
    介绍
        elasticsearch-analysis-pinyin


    o-&gt;
    &quot;analysis&quot; : {
        &quot;analyzer&quot; : {
            &quot;pinyin_analyzer&quot; : {
                &quot;tokenizer&quot; : &quot;my_pinyin&quot;,
                &quot;filter&quot; : &quot;word_delimiter&quot;
            }
        },
        &quot;tokenizer&quot; : {
            &quot;my_pinyin&quot; : {
                # 单字
                &quot;type&quot; : &quot;pinyin&quot;,
                &quot;first_letter&quot; : &quot;none&quot;,
                &quot;padding_char&quot; : &quot; &quot;
            },
            &quot;my_pinyin_fisrt_letter&quot; : {
                # 首字母, 如北京为bj
                &quot;type&quot; : &quot;pinyin&quot;,
                &quot;first_letter&quot; : true,
                &quot;padding_char&quot; : &quot; &quot;
            },
        }
    }
    o-&gt; pinyin
    &quot;analysis&quot; : {
        &quot;tokenizer&quot; : {
            &quot;my_pinyin&quot; : {
                &quot;type&quot; : &quot;pinyin&quot;,
                &quot;keep_separate_first_letter&quot; : false,
                &quot;keep_full_pinyin&quot; : true,
                &quot;keep_original&quot; : true,
                &quot;limit_first_letter_length&quot; : 16,
                &quot;lowercase&quot; : true,
                &quot;remove_duplicated_term&quot; : true
            }
        },
        &quot;analyzer&quot; : {
            &quot;pinyin_analyzer&quot; : {
                &quot;tokenizer&quot; : &quot;my_pinyin&quot;
            }
        }
    }
    &quot;properties&quot;: {
        &quot;name&quot;: {
            &quot;type&quot;: &quot;keyword&quot;,
            &quot;fields&quot;: {
                &quot;pinyin&quot;: {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;store&quot;: &quot;no&quot;,
                    &quot;term_vector&quot;: &quot;with_offsets&quot;,
                    &quot;analyzer&quot;: &quot;pinyin_analyzer&quot;,
                    &quot;boost&quot;: 10
                }
            }
        }
    }

    o-&gt; ik-pinyin
    &quot;analysis&quot;: {
        &quot;filter&quot;: {
            &quot;pinyin1&quot;: {
                &quot;type&quot;: &quot;pinyin&quot;
            }
        },
        &quot;analyzer&quot;: {
            &quot;ik_pinyin_analyzer&quot;: {
                &quot;filter&quot;: [&quot;pinyin1&quot;,&quot;word_delimiter&quot;],
                &quot;type&quot;: &quot;custom&quot;,
                &quot;tokenizer&quot;: &quot;ik_smart&quot;
            }
        }
    },

工具
kopf
bigdesk
head
使用
https://github.com/mobz/elasticsearch-head
cnpm i
npm i -g grunt-cli
grunt server
curl localhost:9100
配置
Gruntfile.js
port:9100
client
olivere/elastic
Search
# SearchService
Do
Index
Query
Sort
From
Pretty
Index
# IndexService
Do
Index
Type
Id
BodyJson
Refresh
Suggest
# SuggestService
query
SimpleQueryString">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://runout.run/docs/db/elasticsearch/">
  <meta property="og:site_name" content="outrun的笔记">
  <meta property="og:title" content="outrun的笔记">
  <meta property="og:description" content="介绍 # 分布式实时lucene 使用 # ./bin/elasticsearch curl http://localhost:9200 命令 # elasticsearch -Ecluster.name=my_cluster_name -Enode.name=my_node_name 概念存储 # index type # document中加_type field实现 # 所以不同type中的field在index要唯一，否则冲突 # 对field排序会载入所有type的document document # 对应lucene中的key value倒排文档 # 对就一个请求的json对象 field mapping # 定义type的field，映射json到document field 设置 # config/elasticsearch.yml action.auto_create_index: -l*, &#43;z* # 自动创建，以z开头和非l开头的索引 action.destructive_requires_name: true # 允许通配删index http.cors.enables: true http.cors.allow-origin: &#34;*&#34; cluster.name: c1 node.name: n1 node.master: true node.data: true transport.host: localhost transport.tcp.port: 9300 network.host: 0.0.0.0 # 修改es监听地址，别的机器也可以访问。同时设置bind_host和publish_host # 需要设置transport.host:localhost network.bind_host # 节点绑定ip network.publish_host # 发布地址，其它节点通过这个地址通信 http.port: 9200 transport.tcp.port # 通信端口，默认9300 discovery.zen.minimum_master_nodes: 2 o-&gt; 可用配置 cluster.name: myES_Cluster node.name: ESNODE_CYR node.master: true node.data: true transport.host: localhost transport.tcp.port: 9300 http.port: 9200 network.host: 0.0.0.0 discovery.zen.minimum_master_nodes: 2 接口 # index # get/put/delete /index1 # 创建index, get查询，delete删除 settings mappings aliases: put /index1/_mapping/type2 get/put /index1/type2/_mapping # 创建type或给已有type加mappings properties put /index1/_settings get/put /index1/type1/1 # 插入doc name: &#34;name1&#34; _cat # get /_cat/health?v # 集群健康 get /_cat/nodes?v # 集群节点 get /_cat/indices?v # 所有索引 _cluster # get /_cluster/state?pretty # 集群状态 _aliases # post /_aliases # 索引别名 actions: add: alias: &#34;my_index&#34; index: &#34;my_index_v1&#34; remove _template # put /_template/tpl1 template: &#34;te*&#34; # 匹配所有re开头的index settings: mappings: _search # post /index1/type1/_search # from size实时分页 # scroll快照分页 ?from=0&amp;size=50 ?scroll=1m&amp;size=50 # 过期时间1分钟，每次返回50条 ?search_type=scan&amp;scroll=1m # scroll-scan分页不排序，更快, _analyze # post /index1/_analyze text: &#34;刘德华&#34; analyzer: &#34;analyzer1&#34; _close # post /index1/_close # 关闭索引，此后可以改settings _open # post /index1/_open _cache # post /index1/type1/_cache/clear?filter_keys=k1 # 清空query filter的缓存 数据对象 # _search # query match # 理解如何分词的, 会对field分词再查询 field1: query: &#34;a b&#34; operator: &#34;and&#34; minimum_should_match: &#34;75%&#34; # 匹配的query分词的最低占比 match_all # 默认，会查出所有文档 multi_match query: &#34;a b&#34; fields: [&#34;field1&#34;, &#34;field2&#34;] match_phrase # 所有term命中，并且位置邻接 field1: &#34;a b&#34; term # 确切查询 field1: &#34;value1&#34; terms # 多条件and field1: [1,2,3] range field1: gt: 20 gte: lt: lte: exists: field: &#34;field1&#34; missing: field: &#34;field1&#34; regexp postcode: &#34;W[0-9].&#43;&#34; wildcard postcode: &#34;W?F*HW&#34; prefix # 以某些字符开头 field1: &#34;a&#34; bool # 分值计算来自must和should语句, must_not不影响 must match must_not should: [] minimum_should_match: 2 filtered query filter: # filter的field会缓存起来 ## geo, and, or, not, script, numeric_range的默认不缓存 term: field1: &#34;a&#34; _cache_key: &#34;k1&#34; _cache: false range: field1: gte: 0 aggs diy1: avg: field: &#34;field1&#34; diy2: terms: # 聚合查询中的所有term field: &#34;field1&#34; post_filter: # 对搜索结果进行过滤 term: field1: &#34;a&#34; sort: [] # 默认升序，_score默认降序 field1 order: &#34;desc&#34; # asc mode: &#34;min&#34; # 对数组元素排序时的取值, 还有max, sum, avg, median missing: &#34;field1&#34; &#34;_score&#34;, highlight pre_tags: [&#34;&lt;tag1&gt;&#34;] post_tags: [&#34;&lt;/tag1&gt;&#34;] fields: content: {} simple_query_string: query: &#34;&#34; analyzer: fields: [&#34;body^5&#34;, &#34;_all&#34;] default_operator: &#34;and&#34; mappings # type1: dynamic: true # 默认true,自动给未知field建索引 # false: 忽略未知field， strict: 未知field报错 include_in_all: false # 默认不include _all: # meta field enabled: false # 关闭all作用域 analyzer: # 其实是search_analyzer term_vector: no # 对field建立词频向量空间 store: &#34;false&#34; _source: # 是否保存内容 enabled: true properties: field1: type: “text” # text分词，keyword不分词，numeric, date, string # multi_field可定义多个field fields:[] field1: type store: &#34;yes&#34; index: &#34;not_analyzed&#34; # analyzed analyzer: &#34;ik_max_word&#34; search_analyzer: &#34;ik_max_word&#34; # 默认为analyzer include_in_all: &#34;true&#34; # 是否加入_all作用域 boost: 8 aliases # alias1: filter: term: user: &#34;kimchy&#34; routing: &#34;kimchy&#34; settings # # 有些设置不能动态修改 index: number_of_shards: 3 number_of_replicas: 2 max_result_window: 10000 # from &#43; size的上限，默认10000 analysis: tokenizer: # 处理原始输入 tokenizer1 type: &#34;pinyin&#34; pinyin_field1: filter: # tokenizer作为输入 filter1: type: &#34;pinyin&#34; pinyin_field1: analyzer: # 组合tokenizer和filter analyzer1: type: &#34;custom&#34; tokenizer: &#34;ik_smart&#34; filter: [&#34;filter1&#34;, &#34;word_delimiter&#34;] 插件 # 使用 复制到/plugins 场景中，指定type:&#34;xx&#34;使用 ## ik 介绍 elasticsearch-analysis-ik 安装 mvn package unzip -d /elasticsearch/plugins/ik ./target/releases/elasticsearch-analysis-ik-1.8.0.zip 重启elasticsearch 分词器 ik_max_word curl -XGET &#39;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_max_word&#39; -d &#39;联想是全球最大的笔记本厂商&#39; ik_smart curl -XGET &#39;http://localhost:9200/_analyze?pretty&amp;analyzer=ik_smart&#39; -d &#39;联想是全球最大的笔记本厂商&#39; mapping type { &#34;properties&#34;: { &#34;content&#34;: { &#34;type&#34;: &#34;text&#34;, &#34;store&#34;: &#34;no&#34;, &#34;term_vector&#34;: &#34;with_positions_offsets&#34;, &#34;analyzer&#34;: &#34;ik_smart&#34;, &#34;search_analyzer&#34;: &#34;ik_smart&#34;, &#34;include_in_all&#34;: &#34;true&#34;, &#34;boost&#34;: 8 } } } ## pinyin 介绍 elasticsearch-analysis-pinyin o-&gt; &#34;analysis&#34; : { &#34;analyzer&#34; : { &#34;pinyin_analyzer&#34; : { &#34;tokenizer&#34; : &#34;my_pinyin&#34;, &#34;filter&#34; : &#34;word_delimiter&#34; } }, &#34;tokenizer&#34; : { &#34;my_pinyin&#34; : { # 单字 &#34;type&#34; : &#34;pinyin&#34;, &#34;first_letter&#34; : &#34;none&#34;, &#34;padding_char&#34; : &#34; &#34; }, &#34;my_pinyin_fisrt_letter&#34; : { # 首字母, 如北京为bj &#34;type&#34; : &#34;pinyin&#34;, &#34;first_letter&#34; : true, &#34;padding_char&#34; : &#34; &#34; }, } } o-&gt; pinyin &#34;analysis&#34; : { &#34;tokenizer&#34; : { &#34;my_pinyin&#34; : { &#34;type&#34; : &#34;pinyin&#34;, &#34;keep_separate_first_letter&#34; : false, &#34;keep_full_pinyin&#34; : true, &#34;keep_original&#34; : true, &#34;limit_first_letter_length&#34; : 16, &#34;lowercase&#34; : true, &#34;remove_duplicated_term&#34; : true } }, &#34;analyzer&#34; : { &#34;pinyin_analyzer&#34; : { &#34;tokenizer&#34; : &#34;my_pinyin&#34; } } } &#34;properties&#34;: { &#34;name&#34;: { &#34;type&#34;: &#34;keyword&#34;, &#34;fields&#34;: { &#34;pinyin&#34;: { &#34;type&#34;: &#34;text&#34;, &#34;store&#34;: &#34;no&#34;, &#34;term_vector&#34;: &#34;with_offsets&#34;, &#34;analyzer&#34;: &#34;pinyin_analyzer&#34;, &#34;boost&#34;: 10 } } } } o-&gt; ik-pinyin &#34;analysis&#34;: { &#34;filter&#34;: { &#34;pinyin1&#34;: { &#34;type&#34;: &#34;pinyin&#34; } }, &#34;analyzer&#34;: { &#34;ik_pinyin_analyzer&#34;: { &#34;filter&#34;: [&#34;pinyin1&#34;,&#34;word_delimiter&#34;], &#34;type&#34;: &#34;custom&#34;, &#34;tokenizer&#34;: &#34;ik_smart&#34; } } }, 工具 kopf bigdesk head 使用 https://github.com/mobz/elasticsearch-head cnpm i npm i -g grunt-cli grunt server curl localhost:9100 配置 Gruntfile.js port:9100 client olivere/elastic Search # SearchService Do Index Query Sort From Pretty Index # IndexService Do Index Type Id BodyJson Refresh Suggest # SuggestService query SimpleQueryString">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:modified_time" content="2022-09-27T16:27:03+08:00">
<title>Elasticsearch | outrun的笔记</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://runout.run/docs/db/elasticsearch/">
<link rel="stylesheet" href="/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css" integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.82b3d863368d576b09dc9142a93468d8170f7706990cff55b58bfe72c4930b4b.js" integrity="sha256-grPYYzaNV2sJ3JFCqTRo2BcPdwaZDP9VtYv&#43;csSTC0s=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <script data-ad-client="ca-pub-6239994681364905" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<meta name="baidu_union_verify" content="aacbc30462cce84b2333063d99284e3b">
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" class="book-icon" /><span>outrun的笔记</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-28d9e6987399d0da843d24373bb5310b" class="toggle"  />
    <label for="section-28d9e6987399d0da843d24373bb5310b" class="flex justify-between">
      <a href="/docs/architect/" class="">架构</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/code/" class="">代码</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/code/security/" class="">Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/code/design_mode/" class="">Java设计模式</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/project/" class="">工程设计</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/project/ddd/" class="">工程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/project/frontend/" class="">前端</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>战略性技术</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/ai/" class="">AI</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/ai/map/" class="">知识图谱</a>
  

        </li>
      
    
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/iot/" class="">IoT</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/iot/framework/" class="">Framework</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/meta/" class="">IoT</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/meta/media/" class="">媒体</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/middle_platform/" class="">中台</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/block_chain/" class="">Block Chain</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Cloud</span>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/datalake/" class="">Datalake</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/datalake/ecology/" class="">Ecology</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/strategy/edge/" class="">Edge</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/manage/" class="">Manage</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/manage/organize/" class="">组织</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/manage/organize/people/" class="">人员</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/" class="">Method</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/product_plan/" class="">产品规划</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/code_plan/" class="">代码规划</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/ops_plan/" class="">运维规划</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/advice_plan/" class="">咨询规划</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/architect/" class="">服务治理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/project_plan/" class="">项目规划</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/method/test_plan/" class="">测试规划</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/architect/summary/" class="">这些年我做过的技术</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-669f1276b655f93b7e7c5d3bcda5ec19" class="toggle"  />
    <label for="section-669f1276b655f93b7e7c5d3bcda5ec19" class="flex justify-between">
      <a href="/docs/misc/" class="">杂项</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ad4b307ab1b99c68532f747347427ad2" class="toggle"  />
    <label for="section-ad4b307ab1b99c68532f747347427ad2" class="flex justify-between">
      <a href="/docs/middleware/" class="">中间件</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/distributed/" class="">支撑-分布式</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/distributed/spring_cloud/" class="">Spring Cloud</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library_frontend/" class="">前端</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library_frontend/bootstrap/" class="">Bootstrap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library_frontend/threejs/" class="">Threejs</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library_frontend/angular/" class="">Angular</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library_frontend/jquery/" class="">Jquery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library_frontend/react/" class="">React</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library/" class="">小功能</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/library/hibernate/" class="">Hibernate</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Container</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/container/nginx/" class="">Nginx</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/middleware/container/nodejs/" class="">Nodejs</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9d4b4d3532e4d7688278a56c3607ee43" class="toggle"  />
    <label for="section-9d4b4d3532e4d7688278a56c3607ee43" class="flex justify-between">
      <a href="/docs/cache/" class="">Cache</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/cache/ops/" class="">Ops</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cache/work_code/" class="">Work Code</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cache/template/" class="">模板配置</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cache/soft_arch/" class="">软考架构师</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-75015a3dca1e5254e5fd64787822da31" class="toggle"  />
    <label for="section-75015a3dca1e5254e5fd64787822da31" class="flex justify-between">
      <a href="/docs/basic/" class="">基本功</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/speach/" class="">演说</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/body/" class="">身体</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/computer/" class="">Computer</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/computer/principle/" class="">支撑-原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/computer/performance/" class="">Performance</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/algorithm/" class="">算法</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/algorithm/thought/" class="">算法思想</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/algorithm/data_structure/" class="">数据结构</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/basic/algorithm/math/" class="">数学</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-57edaab097f41efb493c8fe5461c9d46" class="toggle"  />
    <label for="section-57edaab097f41efb493c8fe5461c9d46" class="flex justify-between">
      <a href="/docs/tool/" class="">工具</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/ops/" class="">运维</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/ops/monitor/" class="">Monitor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/ops/docker/" class="">Docker</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/ops/k8s/" class="">Kubernetes</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/product/enterprise_system/" class="">企业级系统</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/develop/" class="">Develop</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/develop/eclipse/" class="">Eclipse</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/develop/vim/" class="">VIM</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/develop/apple/" class="">Apple</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/develop/jetbrains/" class="">Jetbrains</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/linux/" class="">Linux</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/linux/linux_program/" class="">LinuxProgram</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/linux/scene/" class="">LinuxScene</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/linux/linux_tool/" class="">LinuxTool</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/product/framework/" class="">Framework</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/physics/" class="">实物工具</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/test/" class="">测试</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tool/test/debug/" class="">程序调试</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-42c70ef47fd41d9af53858047493d78c" class="toggle" checked />
    <label for="section-42c70ef47fd41d9af53858047493d78c" class="flex justify-between">
      <a href="/docs/db/" class="">数据库</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/db/mongodb/" class="">Mongodb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/db/postgresql/" class="">Postgre SQL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/db/elasticsearch/" class="active">Elasticsearch</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/db/mysql/" class="">Mysql</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/db/oracle/" class="">Oracle</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/db/redis/" class="">Redis</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2c3dac8cc024b2be2734e956eea228c9" class="toggle"  />
    <label for="section-2c3dac8cc024b2be2734e956eea228c9" class="flex justify-between">
      <a href="/docs/pl/" class="">程序语言</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/principle/" class="">程序语言原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/haskell/" class="">Haskell</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/elixir/" class="">Elixir</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/go/" class="">Go</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/python/" class="">Python</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/clojure/" class="">Clojure</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/js/" class="">JS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/" class="">Java</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/java_reactive/" class="">Java响应式编程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/javaweb/" class="">JavaWeb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/juc/" class="">Java并发</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/jvm/" class="">JVM</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/collection/" class="">Collection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/java/spring/" class="">Spring</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/markup_language/" class="">Markup Language</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/markup_language/html/" class="">Html</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/pl/markup_language/css/" class="">Css</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Elasticsearch</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#介绍">介绍</a></li>
    <li><a href="#使用">使用</a></li>
    <li><a href="#命令">命令</a></li>
    <li><a href="#概念存储">概念存储</a></li>
    <li><a href="#设置">设置</a></li>
    <li><a href="#接口">接口</a>
      <ul>
        <li><a href="#index">index</a></li>
        <li><a href="#_cat">_cat</a></li>
        <li><a href="#_cluster">_cluster</a></li>
        <li><a href="#_aliases">_aliases</a></li>
        <li><a href="#_template">_template</a></li>
        <li><a href="#_search">_search</a></li>
        <li><a href="#_analyze">_analyze</a></li>
        <li><a href="#_close">_close</a></li>
        <li><a href="#_open">_open</a></li>
        <li><a href="#_cache">_cache</a></li>
        <li><a href="#数据对象">数据对象</a>
          <ul>
            <li><a href="#_search-1">_search</a></li>
            <li><a href="#mappings">mappings</a></li>
            <li><a href="#aliases">aliases</a></li>
            <li><a href="#settings">settings</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#插件">插件</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="介绍">
  介绍
  <a class="anchor" href="#%e4%bb%8b%e7%bb%8d">#</a>
</h1>
<pre><code>分布式实时lucene
</code></pre>
<h1 id="使用">
  使用
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8">#</a>
</h1>
<pre><code>./bin/elasticsearch
curl http://localhost:9200
</code></pre>
<h1 id="命令">
  命令
  <a class="anchor" href="#%e5%91%bd%e4%bb%a4">#</a>
</h1>
<pre><code>elasticsearch -Ecluster.name=my_cluster_name -Enode.name=my_node_name
</code></pre>
<h1 id="概念存储">
  概念存储
  <a class="anchor" href="#%e6%a6%82%e5%bf%b5%e5%ad%98%e5%82%a8">#</a>
</h1>
<pre><code>index
    type
        # document中加_type field实现
        # 所以不同type中的field在index要唯一，否则冲突
        # 对field排序会载入所有type的document
        document
            # 对应lucene中的key value倒排文档
            # 对就一个请求的json对象
            field
                mapping
                    # 定义type的field，映射json到document field
</code></pre>
<h1 id="设置">
  设置
  <a class="anchor" href="#%e8%ae%be%e7%bd%ae">#</a>
</h1>
<pre><code>config/elasticsearch.yml
    action.auto_create_index: -l*, +z*
        # 自动创建，以z开头和非l开头的索引
    action.destructive_requires_name: true
        # 允许通配删index
    http.cors.enables: true
    http.cors.allow-origin: &quot;*&quot;
    cluster.name: c1
    node.name: n1
    node.master: true
    node.data: true
    transport.host: localhost
    transport.tcp.port: 9300
    network.host: 0.0.0.0
        # 修改es监听地址，别的机器也可以访问。同时设置bind_host和publish_host
        # 需要设置transport.host:localhost
    network.bind_host
        # 节点绑定ip
    network.publish_host
        # 发布地址，其它节点通过这个地址通信
    http.port: 9200
    transport.tcp.port
        # 通信端口，默认9300
    discovery.zen.minimum_master_nodes: 2

o-&gt; 可用配置
cluster.name: myES_Cluster
node.name: ESNODE_CYR
node.master: true
node.data: true
transport.host: localhost
transport.tcp.port: 9300
http.port: 9200
network.host: 0.0.0.0
discovery.zen.minimum_master_nodes: 2
</code></pre>
<h1 id="接口">
  接口
  <a class="anchor" href="#%e6%8e%a5%e5%8f%a3">#</a>
</h1>
<h2 id="index">
  index
  <a class="anchor" href="#index">#</a>
</h2>
<pre><code>get/put/delete /index1              # 创建index, get查询，delete删除
    settings
    mappings
    aliases:
put /index1/_mapping/type2
get/put /index1/type2/_mapping      # 创建type或给已有type加mappings
    properties
put /index1/_settings
get/put /index1/type1/1             # 插入doc
    name: &quot;name1&quot;
</code></pre>
<h2 id="_cat">
  _cat
  <a class="anchor" href="#_cat">#</a>
</h2>
<pre><code>get /_cat/health?v                  # 集群健康
get /_cat/nodes?v                   # 集群节点
get /_cat/indices?v                 # 所有索引
</code></pre>
<h2 id="_cluster">
  _cluster
  <a class="anchor" href="#_cluster">#</a>
</h2>
<pre><code>get /_cluster/state?pretty          # 集群状态
</code></pre>
<h2 id="_aliases">
  _aliases
  <a class="anchor" href="#_aliases">#</a>
</h2>
<pre><code>post /_aliases                      # 索引别名
    actions:
        add:
            alias: &quot;my_index&quot;
            index: &quot;my_index_v1&quot;
        remove
</code></pre>
<h2 id="_template">
  _template
  <a class="anchor" href="#_template">#</a>
</h2>
<pre><code>put /_template/tpl1
    template: &quot;te*&quot;
        # 匹配所有re开头的index
    settings:
    mappings:
</code></pre>
<h2 id="_search">
  _search
  <a class="anchor" href="#_search">#</a>
</h2>
<pre><code>post /index1/type1/_search
    # from size实时分页
    # scroll快照分页
    ?from=0&amp;size=50
    ?scroll=1m&amp;size=50
        # 过期时间1分钟，每次返回50条
    ?search_type=scan&amp;scroll=1m
        # scroll-scan分页不排序，更快,
</code></pre>
<h2 id="_analyze">
  _analyze
  <a class="anchor" href="#_analyze">#</a>
</h2>
<pre><code>post /index1/_analyze
    text: &quot;刘德华&quot;
    analyzer: &quot;analyzer1&quot;
</code></pre>
<h2 id="_close">
  _close
  <a class="anchor" href="#_close">#</a>
</h2>
<pre><code>post /index1/_close
    # 关闭索引，此后可以改settings
</code></pre>
<h2 id="_open">
  _open
  <a class="anchor" href="#_open">#</a>
</h2>
<pre><code>post /index1/_open
</code></pre>
<h2 id="_cache">
  _cache
  <a class="anchor" href="#_cache">#</a>
</h2>
<pre><code>post /index1/type1/_cache/clear?filter_keys=k1
    # 清空query filter的缓存
</code></pre>
<h2 id="数据对象">
  数据对象
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%af%b9%e8%b1%a1">#</a>
</h2>
<h3 id="_search-1">
  _search
  <a class="anchor" href="#_search-1">#</a>
</h3>
<pre><code>query
    match
        # 理解如何分词的, 会对field分词再查询
        field1:
            query: &quot;a b&quot;
            operator: &quot;and&quot;
            minimum_should_match: &quot;75%&quot;
                # 匹配的query分词的最低占比
    match_all
        # 默认，会查出所有文档
    multi_match
        query: &quot;a b&quot;
        fields: [&quot;field1&quot;, &quot;field2&quot;]
    match_phrase
        # 所有term命中，并且位置邻接
        field1: &quot;a b&quot;
    term
        # 确切查询
        field1: &quot;value1&quot;
    terms
        # 多条件and
        field1: [1,2,3]
    range
        field1:
            gt: 20
            gte:
            lt:
            lte:
    exists:
        field: &quot;field1&quot;
    missing:
        field: &quot;field1&quot;
    regexp
        postcode: &quot;W[0-9].+&quot;
    wildcard
        postcode: &quot;W?F*HW&quot;
    prefix
        # 以某些字符开头
        field1: &quot;a&quot;
    bool
        # 分值计算来自must和should语句, must_not不影响
        must
            match
        must_not
        should: []
        minimum_should_match: 2
    filtered
        query
        filter:
            # filter的field会缓存起来
            ## geo, and, or, not, script, numeric_range的默认不缓存
            term:
                field1: &quot;a&quot;
                _cache_key: &quot;k1&quot;
                _cache: false
            range:
                field1:
                    gte: 0
aggs
    diy1:
        avg:
            field: &quot;field1&quot;
    diy2:
        terms:
            # 聚合查询中的所有term
            field: &quot;field1&quot;
post_filter:
    # 对搜索结果进行过滤
    term:
        field1: &quot;a&quot;
sort: []
    # 默认升序，_score默认降序
    field1
        order: &quot;desc&quot;
            # asc
        mode: &quot;min&quot;
            # 对数组元素排序时的取值, 还有max, sum, avg, median
        missing: &quot;field1&quot;
    &quot;_score&quot;,
highlight
    pre_tags: [&quot;&lt;tag1&gt;&quot;]
    post_tags: [&quot;&lt;/tag1&gt;&quot;]
    fields:
        content: {}
simple_query_string:
    query: &quot;&quot;
    analyzer:
    fields: [&quot;body^5&quot;, &quot;_all&quot;]
    default_operator: &quot;and&quot;
</code></pre>
<h3 id="mappings">
  mappings
  <a class="anchor" href="#mappings">#</a>
</h3>
<pre><code>type1:
    dynamic: true
        # 默认true,自动给未知field建索引
        # false: 忽略未知field， strict: 未知field报错
    include_in_all: false
        # 默认不include
    _all:
        # meta field
        enabled: false
                # 关闭all作用域
        analyzer:
                # 其实是search_analyzer
        term_vector: no
                # 对field建立词频向量空间
        store: &quot;false&quot;
    _source:
        #  是否保存内容
        enabled: true
    properties:
        field1:
            type: “text”
                # text分词，keyword不分词，numeric, date, string
                # multi_field可定义多个field
            fields:[]
                field1:
                    type
            store: &quot;yes&quot;
            index: &quot;not_analyzed&quot;
                # analyzed
            analyzer: &quot;ik_max_word&quot;
            search_analyzer: &quot;ik_max_word&quot;
                # 默认为analyzer
            include_in_all: &quot;true&quot;
                # 是否加入_all作用域
            boost: 8
</code></pre>
<h3 id="aliases">
  aliases
  <a class="anchor" href="#aliases">#</a>
</h3>
<pre><code>alias1:
    filter:
        term: user: &quot;kimchy&quot;
    routing: &quot;kimchy&quot;
</code></pre>
<h3 id="settings">
  settings
  <a class="anchor" href="#settings">#</a>
</h3>
<pre><code># 有些设置不能动态修改
index:
    number_of_shards: 3
    number_of_replicas: 2
    max_result_window: 10000
        # from + size的上限，默认10000
    analysis:
        tokenizer:
            # 处理原始输入
            tokenizer1
                type: &quot;pinyin&quot;
                pinyin_field1:
        filter:
            # tokenizer作为输入
            filter1:
                type: &quot;pinyin&quot;
                pinyin_field1:
        analyzer:
            # 组合tokenizer和filter
            analyzer1:
                type: &quot;custom&quot;
                tokenizer: &quot;ik_smart&quot;
                filter: [&quot;filter1&quot;, &quot;word_delimiter&quot;]
</code></pre>
<h1 id="插件">
  插件
  <a class="anchor" href="#%e6%8f%92%e4%bb%b6">#</a>
</h1>
<pre><code>使用
    复制到/plugins
    场景中，指定type:&quot;xx&quot;使用
## ik
    介绍
        elasticsearch-analysis-ik
    安装
        mvn package
        unzip -d /elasticsearch/plugins/ik ./target/releases/elasticsearch-analysis-ik-1.8.0.zip
        重启elasticsearch
    分词器
        ik_max_word
            curl -XGET 'http://localhost:9200/_analyze?pretty&amp;analyzer=ik_max_word' -d '联想是全球最大的笔记本厂商'
        ik_smart
            curl -XGET 'http://localhost:9200/_analyze?pretty&amp;analyzer=ik_smart' -d '联想是全球最大的笔记本厂商'
    mapping type
        {
        &quot;properties&quot;: {
            &quot;content&quot;: {
            &quot;type&quot;: &quot;text&quot;,
            &quot;store&quot;: &quot;no&quot;,
            &quot;term_vector&quot;: &quot;with_positions_offsets&quot;,
            &quot;analyzer&quot;: &quot;ik_smart&quot;,
            &quot;search_analyzer&quot;: &quot;ik_smart&quot;,
            &quot;include_in_all&quot;: &quot;true&quot;,
            &quot;boost&quot;: 8
            }
        }
        }
## pinyin
    介绍
        elasticsearch-analysis-pinyin


    o-&gt;
    &quot;analysis&quot; : {
        &quot;analyzer&quot; : {
            &quot;pinyin_analyzer&quot; : {
                &quot;tokenizer&quot; : &quot;my_pinyin&quot;,
                &quot;filter&quot; : &quot;word_delimiter&quot;
            }
        },
        &quot;tokenizer&quot; : {
            &quot;my_pinyin&quot; : {
                # 单字
                &quot;type&quot; : &quot;pinyin&quot;,
                &quot;first_letter&quot; : &quot;none&quot;,
                &quot;padding_char&quot; : &quot; &quot;
            },
            &quot;my_pinyin_fisrt_letter&quot; : {
                # 首字母, 如北京为bj
                &quot;type&quot; : &quot;pinyin&quot;,
                &quot;first_letter&quot; : true,
                &quot;padding_char&quot; : &quot; &quot;
            },
        }
    }
    o-&gt; pinyin
    &quot;analysis&quot; : {
        &quot;tokenizer&quot; : {
            &quot;my_pinyin&quot; : {
                &quot;type&quot; : &quot;pinyin&quot;,
                &quot;keep_separate_first_letter&quot; : false,
                &quot;keep_full_pinyin&quot; : true,
                &quot;keep_original&quot; : true,
                &quot;limit_first_letter_length&quot; : 16,
                &quot;lowercase&quot; : true,
                &quot;remove_duplicated_term&quot; : true
            }
        },
        &quot;analyzer&quot; : {
            &quot;pinyin_analyzer&quot; : {
                &quot;tokenizer&quot; : &quot;my_pinyin&quot;
            }
        }
    }
    &quot;properties&quot;: {
        &quot;name&quot;: {
            &quot;type&quot;: &quot;keyword&quot;,
            &quot;fields&quot;: {
                &quot;pinyin&quot;: {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;store&quot;: &quot;no&quot;,
                    &quot;term_vector&quot;: &quot;with_offsets&quot;,
                    &quot;analyzer&quot;: &quot;pinyin_analyzer&quot;,
                    &quot;boost&quot;: 10
                }
            }
        }
    }

    o-&gt; ik-pinyin
    &quot;analysis&quot;: {
        &quot;filter&quot;: {
            &quot;pinyin1&quot;: {
                &quot;type&quot;: &quot;pinyin&quot;
            }
        },
        &quot;analyzer&quot;: {
            &quot;ik_pinyin_analyzer&quot;: {
                &quot;filter&quot;: [&quot;pinyin1&quot;,&quot;word_delimiter&quot;],
                &quot;type&quot;: &quot;custom&quot;,
                &quot;tokenizer&quot;: &quot;ik_smart&quot;
            }
        }
    },
</code></pre>
<p>工具
kopf
bigdesk
head
使用
<a href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a>
cnpm i
npm i -g grunt-cli
grunt server
curl localhost:9100
配置
Gruntfile.js
port:9100
client
olivere/elastic
Search
# SearchService
Do
Index
Query
Sort
From
Pretty
Index
# IndexService
Do
Index
Type
Id
BodyJson
Refresh
Suggest
# SuggestService
query
SimpleQueryString</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/outrunJ/hugo-blog/commit/6524a2f2aefb1d10b8ed0a97628bf62cfdd62ff2" title='Last modified by outrun | Sep 27, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>Sep 27, 2022</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/outrunJ/hugo-blog/tree/master/content/content/docs/db/elasticsearch.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#介绍">介绍</a></li>
    <li><a href="#使用">使用</a></li>
    <li><a href="#命令">命令</a></li>
    <li><a href="#概念存储">概念存储</a></li>
    <li><a href="#设置">设置</a></li>
    <li><a href="#接口">接口</a>
      <ul>
        <li><a href="#index">index</a></li>
        <li><a href="#_cat">_cat</a></li>
        <li><a href="#_cluster">_cluster</a></li>
        <li><a href="#_aliases">_aliases</a></li>
        <li><a href="#_template">_template</a></li>
        <li><a href="#_search">_search</a></li>
        <li><a href="#_analyze">_analyze</a></li>
        <li><a href="#_close">_close</a></li>
        <li><a href="#_open">_open</a></li>
        <li><a href="#_cache">_cache</a></li>
        <li><a href="#数据对象">数据对象</a>
          <ul>
            <li><a href="#_search-1">_search</a></li>
            <li><a href="#mappings">mappings</a></li>
            <li><a href="#aliases">aliases</a></li>
            <li><a href="#settings">settings</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#插件">插件</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












