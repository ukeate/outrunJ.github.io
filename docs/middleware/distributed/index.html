<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  名词
  #

Alb        automaticLoopBack 自动回环，虚拟接口
sdn        software defined network 软件定义网络


  Serverless
  #

knative
    # google开源，serverless标准化方案，基于kubernetes和istio
    模块
        build
        serving
        eventing


  ServiceMesh
  #


  Service Fabric
  #

# 微软


  Istio
  #

#google IBM, lyft开源，基于envoy
组成
    数据面板
    控制面板


  Knative
  #

介绍
    管理kubernetes, Istio
模块
    build
    serve
        config
        route
    event


  Traefik
  #

# go实现，多后台如kubernetes, swarm, marathon, mesos


  Linkerd
  #

# buoyant出品


  Conduit
  #

# 面向kubernetes轻量化mesh


  Fingle
  #

# twitter出品


  Envoy
  #

# lyft出品


  Nginmesh
  #

# nginx推出


  PaaS
  #

# platform as a service


  CloudStack
  #

# 托管在apache的开源、高可用、高扩展性的云计算平台
# 支持主流hypervisors
# 一个开源云计算解决方案，可以加速iaaS的部署、管理、配置


  CloudFoundry
  #

# pivotal开源, 根据应用模板，动态生成很多tomcat, mysql, nosql, 动态控制这些实例的启停。


  OpenStack
  #

# 云操作系统，管理虚拟资源


  Container Orchestration
  #


  
      
          特性
          dubbo
          spring cloud
          kubernetes
      
  
  
      
          配置管理
          -
          config
          kubernetes configMap
      
      
          服务发现
          zookeeper
          eureka, consul, zookeeper
          kubernetes services
      
      
          负载均衡
          自带
          ribbon
          kubernetes services
      
      
          网关
          -
          zuul
          kubernetes services
      
      
          分布式追踪
          -
          spring cloud sleuth
          open tracing
      
      
          容错
          不完善
          hystrix
          kubernetes health check
      
      
          通信方式
          rpc
          http, message
          
      
      
          安全模块
          -
          spring cloud security
          -
      
      
          分布式日志
          
          ELK
          EFK
      
      
          任务管理
          
          spring batch
          kubernetes jobs
      
  


  Kubernetes
  #

# google开源的，borg的发展，在docker技术上，管理容器化应用
特点
    不限语言
    无侵入, 服务只写业务
    适合微服务                       # 调整服务副本数, 横向扩容
    无缝迁移到公有云                  # cluster ip实现不改配置迁移
    自动化资源管理
        服务发现，用dns解析服务名
        内嵌负载均衡
        部署实施
        治理
        监控
        故障发现、自我修复
        透明服务注册、发现
        服务滚动升级、在线扩容, 根据负载自动扩容缩容
        可扩展资源自动调度、多粒度资源配额
    多层安全防护、准入
    多租户
    完善的工具

    pod运行容器
    etcd保存所有状态
架构
    cluster
        master
            api server              # 对外http rest接口, 管理资源对象(pod, RC, service)增删改查
            controller manager      # 管理控制器, node, pod, endpoint, namespace, serviceAccount, resourceQuota自动化管理
            scheduler               # 接收controller manager命令执行pod调度
            etcd                    # 配置
        node                        # 一master多node
            特点
                node宕机，pod调度到其它节点
            pod                     # 一node几百个pod, 基本操作单元，代表一个运行进程，内部封装一个(或多个紧密相关的)容器。
                特点
                    pod内通信高效，放密切相关服务进程
                    可以判断一组相关容器的状态(用pause)
                    pause解决共享ip、容器通信、共享文件的问题
                    pod间通信用虚拟二层协议(flannel, openvswitch)实现
                    普通pod在etcd存储，再调度到某node实例化，静态pod在node中存储，在node实例化
                    对pod可进行资源(cpu,内存)限额
                label               # 标签，用标签选择器选择。key和value由用户指定，可附加到node, pod, service, rc等
                pause容器            # 根容器，共享网络栈、挂载卷
            docker/rocket           # 容器
            kubelet                 # master监视pod, 创建、修改、监控、删除
            kube-proxy              # 代理pod接口
            fluentd                 # 日志收集、存储、查询
            kube-dns                # 服务dns解析
概念
    service                         # 服务网关
        特点
            唯一名字
            唯一虚拟ip(cluster ip, service ip, vip)                  # 可多端口，每端口有名字
            提供远程服务              # 目前socket
            应用到一组pod
    event                           # 探针检测失败记录，用于排查故障
    rc                              # replication controller
        副本数
        筛选标签
        pod模板
        改变pod镜像版本，滚动升级
    replica set                     # 1.2 rc升级, 支持基于集合的标签选择。被deployment使用
    deployment                      # pod编排, rc升级
        特点
            查看pod部署进度
    HPA                             # horizontal pod autoscaler, 自动扩容缩容
        指标
            cpu utilization percentage                              # 1分钟内利用率平均值
            应用自定义指标(tps, qps)
    volume
        emptyDir
        hostPath
        gcePersistentDisk
        awsElasticBlockStore
        NFS
        persistent volume
        namespace
        annotation
动作
    扩容
        创建rc自动创建pod, 调度到合适的node
            pod定义
            副本数
            监控label                # 筛选pod得到数量
命令
    kubectl
        --help                      # 帮助, 各命令之后都可加
        version
        cluster-info
        logs
            kubectl logs --tail=1000 appID1
                # 查看日志
        run
        exec
            kubectl exec -it appID1 /bin/sh
                # 交互命令进入app
        create
            -f mysql-rc.yaml        # 创建rc
            -f mysql-svc.yaml       # 创建service
        set 
            image
        get
            rc                      # 查看rc
            pods
            pod
                -o
                    wide            # 显示详情，有node name
                o-&gt;
                kubectl get pod -l app=app1 -o wide
                    # 查看pod app状态
            services
            svc                     # 查看service, 包含cluster ip
            nodes
            endpoints               # service pod的ip:端口
            deployments
        describe                    # 详情
            node
            pods
            deployments
        expose
        label
        delete
        scale                       # pod扩容或缩容
            --replicas=2
        autoscale                   # 创建hpa对象
            deployment
        rolling-update              # pod滚动升级
        rollout
            status
            undo
        apply                       # 应用配置
            -f
        proxy
    kubelet
    kube-apiserver
    kube-proxy
    kube-scheduler
    kubeadm
    kube-controller-manager
    hyperkube
    apiextensions-apiserver
    mounter
镜像
    kube-apiserver
    kube-controller-manager
    kube-scheduler
    kube-proxy
    pause
    etcd
    coredns
配置
    用yaml或json定义
    pod
        kind: Pod                   # 表明是Pod
        metadata:
            name: myweb             # pod名
            labels:
                name: myweb         # 标签


  Spring Cloud
  #


  Mesos
  #

# twitter, apache开源的分布式资源管理框架, 两级调度器


  Dubbo
  #

介绍
    阿里开源，分布式服务框架，rpc方案，soa治理
功能
    远程通讯    # 多协议，多种长连接nio框架封装
    集群容错    # 负载均衡，容错，地址路由，动态配置
    自动发现    # 注册中心
节点
    容器(container)
    提供者(provider)
    消费者(consumer)
    注册中心(registry)
    监控中心(monitor)
    调用关系
        容器启动提供者
        提供者注册
        消费者订阅
        注册中心返回地址列表, 长连接更新
        消费者软负载均衡挑选列表中提供者
        提供者和消费者累计调用次数和时间，定时发送到监控中心
容错机制
    failover    # 默认，失败自动切换
    failfast    # 立即报错，用于幂等写操作
    failsafe    # 忽略
    failback    # 定时重发
    forking     # 并行多个取最快(any)
    broadcast   # 逐个多个，异常退出
连接方式
    广播      # 不需要中心节点，适用开发测试, 地址段224.0.0.0 - 239.255.255.255
        服务端配置 applicationContext-service.xml
            &lt;dubbo:application name=”taotao-manager-service” /&gt;
            &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;
            &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” ref=”testServiceImpl” /&gt;
        客户端配置 springMVC.xml
            &lt;dubbp:application name=”taotao-manager-web” /&gt;
            &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” id=”testService”
            timeout=”10000000” /&gt;
    直连
        服务端配置
            &lt;dubbo:application name=”taotao-manager-service” /&gt;
            &lt;dubbo:registry address=”N/A” /&gt;
            &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” ref=”testServiceImpl” /&gt; applicationContext-service.xml
        客户端配置 springMVC.xml
            &lt;dubbp:application name=”taotao-manager-web” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” id=”testService”
            timeout=”10000000” /&gt;
注册中心
    zookeeper


  Dubbox
  #

介绍
    当当网扩展Dubbo


  Netflix OSS
  #


  orleans
  #

# .NET


  HSF
  #

# high-speed service framework, 阿里出品， socket直连
特点
    不增加中间点(稳定，高度可伸缩)
结构
    注册服务信息，推送服务地址
    基于osgi
组件
    服务提供者
    消费者
    地址服务器
    配置服务器               # 分布式配置
    规则服务(diamond)       # 设置(黑白名单，认证，权重，限流)与推送


  NScale
  #

# 可扩展容器，用node.js和docker实现


  Armada
  #

# python微服务


  SOA
  #

# 面向服务架构 service oriented architecture


  EAI
  #

# Enterprise Application Integration 建立底层结构将异构应用集成


  ESB
  #

# Enterprise Service Bus 企业服务总线， 是连接中枢


  RPC
  #

# 远程过程调用 remote procedure call


  Thrift
  #


  CXF
  #

常识
    自己内部整合spring(但是不耦合)
支持的协议
    soap1.1/1.2
    post/http
    restful
    http
使用
    导入cxf包
    方法1      # 不支持注解
        String address=&quot;http://localhost:8888/hello&quot;;
            ServerFactoryBean factoryBean=new ServerFactoryBean();
            factoryBean.setAddress(address);
            factoryBean.setServiceBean(new MyWS());
            factoryBean.create();
    方法2      # 支持注解,wsdl文件中类型不再单独schema文件
        ServerFactoryBean factoryBean = new JaxWsServerFactoryBean      # java and xml web service
    日志    # 记录握手信息(访问wsdl文件)
            ## 看日志记录得到 soap
        serverFactoryBean.getInInterceptors().add(new LoggingInInterceptor());
        serverFactoryBean.getOutInterceptors().add(new LoggingOutInterceptor());
整合spring
    o-&gt; cxf2.4.4.jar/schemas/jaxws.xsd中找到命名空间&quot;http://cxf.apache.org/jaxws&quot;
    o-&gt; 配置applicationContext.xml，加入cxf的命名空间http://cxf.apache.org/jaxws,schema地址为http://cxf.apache.org/schemas/jaxws.xsd。
        并且在eclipse中配置schema约束文件的路径
            # 该xsd约束文件的url地址用的是包地址,不规范
    o-&gt; applicationContext.xml中配置
        &lt;bean id=&quot;studentService&quot; class=&quot;test.spring.StudentServiceImpl&quot;/&gt;
            # 用于：自身调用，被spring引用
        &lt;jaxws:server serviceClass=&quot;test.spring.StudentService&quot; address=&quot;/student&quot;&gt;
            # address配置服务的名称即可(web.xml的servlet中配置了服务的实际访问地址)
            ## serviceClass配置的才是真正的服务，既然它是接口，那么webService注解也应该写在接口上
            &lt;jaxws:serviceBean&gt;
                &lt;ref bean=&quot;studentService&quot;/&gt;
            &lt;jaxws:inInterceptors&gt;
                &lt;bean class=&quot;org.apache.cxf.interceptor.LoggingInInterceptor&quot; /&gt;
            &lt;jaxws:outInterceptors&gt;
                &lt;bean class=&quot;org.apache.cxf.interceptor.LoggingOutInterceptor&quot; /&gt;
    o-&gt; web.xml中配置servlet
         &lt;servlet&gt;
              &lt;servlet-name&gt;springWS
              &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet        # 在cxf-2.4.4.jar包中
              &lt;load-on-startup&gt;1
         &lt;servlet-mapping&gt;
              &lt;servlet-name&gt;springWS
              &lt;url-pattern&gt;/ws/*
    o-&gt; web.xml中配置spring监听器


  GRPC
  #


  Protobuf
  #

# 通信协议
命令
    protoc -I. -I-I$GOPATH/src  --go_out=plugins=grpc:. *
        # -I import目录
    protoc --grpc-gateway_out=.
插件
    安装
        # go build 出protoc-gen-go后，放入go/bin下
    protoc-gen-go
        # 编译proto文件
    protoc-gen-grpc-gateway
        # http服务


  RMI
  #

# java远程调用 remote method invocation


  Hessian
  #

# 是caucho公司的开源协议,基于http


  Burlap
  #

# caucho公房的开源协议,基于http


  HttpInvoker
  #

# spring提供的协议，必须用spring


  Web Service
  #

# soap通讯


  粘合层
  #


  治理(服务发现)
  #


  Zookeeper
  #

介绍
    google chubby的开源实现。用于服务发现
    保证CP
    分布式, hadoop中hbase的组件
    fast paxos算法        # paxos存在活锁问题, fast paxos通过选举产生leader, 只有leader才能提交proposer
功能
    配置维护
    域名服务
    分布式同步
    组服务
    分布式独享锁、选举、队列
流程
    选举leader        # 多种算法, leader有最高执行ID
    同步数据
    大多数机器得到响应follow leader
exhibitor
    # supervisor for zk


  Eureka
  #

# Netflix，保证AP


  Consul
  #

# Apache，保证CA


  Etcd
  #

# kubernetes用，保证CP


  路由控制
  #

负载均衡策略
    随机、轮询、调用延迟判断、一致性哈希、粘滞连接
本地路由优先策略
    优先JVM（injvm），优先相同物理机（innative）
配置方式
    统一注册表、本地配置、动态下发


  配置
  #


  Spring Cloud Config
  #


  Diamond
  #

# 淘宝


  Archaius
  #

# netflix


  Disconf
  #

# 百度


  QConf
  #

# 360


  任务
  #


  Elastic-Job
  #

# 当当网


  Azkaban
  #

# linkedin


  Spring Cloud Task
  #


  跟踪
  #


  zipkin
  #

# twitter


  Opentracing
  #


  Hydra
  #

# 京东


  Spring Cloud Sleuth
  #


  监控
  #


  Spy.js
  #

# webstorm用的监控工具


  Alinode
  #

# 朴灵写的运行时性能管理工具


  OneAPM
  #

# 监控node性能
功能
    接口响应时间
    数据库方法时间
    外部服务时间
    单请求的耗时比


  容错
  #


  Hystrix
  #

功能
    服务线程隔离、信号量隔离
    降级: 超时、资源不足
    熔断: 自动降级、快速恢复
    请求缓存、请求合并


  代理
  #


  Gearman
  #

# 分布式计算, 把工作委派给其他机器


  Hazelcast
  #

# 基于内存的数据网格，用于分布式计算


  Twemproxy
  #

redis/memcache分片代理


  高可用
  #

# high-availability linux
目标
    reliability: 可靠性
    availability: 可用性
    serviceability: 可服务性
        ras: remote access service(远程服务访问)
术语
    节点(node): 唯一主节点，多个备用节点
    资源(resource): 是节点可控制的实体，主节点发生故障时，可以被其它节点接管
        例如:
            磁盘分区
            文件系统
            ip地址
            应用程序服务
            nfs文件系统
    事件(event): 集群中可能发生的事件
        例如:
            系统故障
            网络连通故障
            网卡故障
            应用程序故障
    动作(action): 事件发生时ha的响应方式
        例如: 用shell 脚本对资源进行转移


  心跳
  #


  HeartBeat
  #

2.0模块
    heartbeat: 节点间通信检测模块
    ha-logd: 集群事件日志服务
    CCM(Consensus CLuster Membership): 集群成员一致性管理模块
    LRM(Local Resource Manager): 本地资源管理模块
    Stonith Daemon: 使出现问题的节点从集群资源中脱离
    CRM(Cluster Resource management): 集群资源管理模块
    Cluster policy engine: 集群策略引擎
            用于实现节点与资源之间的管理与依赖关系
    Cluster transition  engine: 集群转移引擎

3.0拆分之后的组成部分
    Heartbeat: 负责节点之间的通信
    Cluster Glue: 中间层，关联Heartbeat 与 Pacemaker,包含LRM 与 stonith
    Resource Agent: 控制服务启停，监控服务状态脚本集合，被LRM调用
    Pacemaker: 也就是曾经的CRM，包含了更多的功能
        管理接口:
            crm shell
            一个使用ajax web 的web窗口
            hb_gui图形工具
            DRBD-MC, 一个基于java的工具

版本差异
    与1.x相比，2.1.x版本变化
        保留原来所有功能
        自动监控资源
        对各资源组进行独立监控
        同时监控系统负载
            自动切换到负载低的node上


  Keepalived
  #

vrrp
    # virtual router redundancy protocol 虚拟路由器冗余协议
    # 解决静态路由出现的闪单点故障问题，它能够保证网络的不间断．稳定运行


  负载
  #

# load balance
方法
        dns轮循

        java nio
        erlang语言
        linux epoll
        bsd kqueue
        消息队列、事件通知
        c/c&#43;&#43;下ace, boost.asio, libev(libevent)
        服务器mina, jetty, node.js, netty
        java协程框架 quasar kilim


  Haproxy
  #

监控页面
        /status


  Tengine
  #

# 淘宝基于nginx修改，添加了功能
监控
    /upstream_status


  OpenResty
  #

# 淘宝改的nginx, lua工具
安装
    yum install -y gcc gcc-c&#43;&#43; kernel-devel readline-devel pcre-devel openssl-devel openssl zlib zlib-devel pcre-devel
    wget openresty-1.9.15.1.tar.gz
    ./configure --prefix=/opt/openresty --with-pcre-jit --with-ipv6 --without-http_redis2_module --with-http_iconv_module -j2
    make &amp;&amp; make install
    ln -s /opt/openresty/nginx/sbin/nginx /usr/sbin
    /opt/openresty/nginx/conf/nginx.conf


  Varnish
  #

# 反向代理, http缓存


  Traffic Server
  #

# apache 缓存


  Squid
  #

配置文件
    /etc/squid/squid.conf
代理类型
    普通代理
    透明代理
    反向代理
缓存
    动态资源
    静态资源
参考资料
    squid 透明代理详解
配置
    # squid.conf
    http_port 3128                                                # squid服务端口
    icp_port 3130                                                # udp端口,用来接收和发送ICP消息
    cache_dir ufs /var/spool/squid                                # 缓存目录, 写入方式有aufs与ufs两种,aufs使用大量线程异步进行磁盘i/o操作
    cache_access_log /var/log/squid/access.log
    cache_log /var/log/squid/cache.log
    cache_store_log /var/log/squid/store.log
    pid_filename /var/run/squid.pid                        # 日志文件位置

    #auth_param basic children 5
    #auth_param basic realm Squid proxy-caching web server
    #auth_param basic credentialsttl 2 hours                 # 关闭认证，认证一般不需要

    cache_effective_user squid
    cache_effective_group squid
    cache_mgr youraccount@your.e.mail                        # 设置squid用户及用户组、管理员账号

    cache_mem 128 MB                                        # 运行内存配置

    cache_swap_low 90
    cache_swap_high 95
    maximum_object_size 4096 KB                        ＃ 与磁盘容量相关的配置，90、95为百分比，磁盘大时4096 KB可以改成32768 KB

    maximum_object_size_in_memory 8 KB                ＃ 内存缓存资料大小

    以下为定义acl(访问控制列表)
            ＃ 语法为:acl&lt;acl&gt; &lt;acl名称&gt; &lt;acl类型&gt; &lt;配置的内容&gt;
    acl All src 0/0
    acl Manager proto cache_object  acl Localhost src 127.0.0.1/32
    acl Safe_ports port 80 21 443 563 70 210 280 488 591 777 1025-65535
    acl SSL_ports 443 563
    acl CONNECT method CONNECT
    acl MyNetwork src 192.168.0.0/16

    以下为利用前面定义的acl,定义访问控制规则
    http_access allow Manager Localhost
    http_access deny Manager
    http_access deny !Safe_ports
    http_access deny CONNECT SSL_ports
    http_access allow MyNetwork
    http_access deny All

    例子: 禁止访问sina
    acl sina dstdomain .sina.com.cn .sina.com
    http_access deny sina
    或
    acl sina dst 58.63.236.26 58.63.236.27 58.63.236.28 58.63.236.29 58.63.236.30 58.63.236.31 58.63.236.32 58.63.236.33 58.63.236.34 58.63.236.35 58.63.236.36 58.63.236.37 58.63.236.38 58.63.236.39 58.63.236.49 58.63.236.50
    http_access deny sina
    或
    acl sina dst www.sina.com.cn
    http_access deny sina

    例子: 禁止来自某些ip的访问
    acl zhang src 192.168.63.6/32
    http_access deny zhang

    例子: 禁止在某些时段访问
    acl Working_hours MTWHF 08:00-17:00
    http_access allow Working_hours
    http_access deny !Working_hours

    例子: 禁止某个代理客户建立过多连接
    acl OverConnLimit maxconn
    http_access deny OverConnLimit

    定义与其它代理服务器的关系,语法: &lt;cache_peer&gt; &lt;主机名称&gt; &lt;类别&gt; &lt;http_port&gt; &lt;icp_port&gt; &lt;其它参数&gt;
    cache_peer 192.168.60.6 parent 4480 7 no-query default

    #设置与其它代理服务器的关系: &lt;cache_peer_access&gt; &lt;上层 Proxy &gt; &lt;allow|deny&gt; &lt;acl名称&gt;
    #cache_peer_access 192.168.60.6 allow aclxxx
    #cache_peer_access 192.168.60.6 deny !aclxxx
    coredump_dir /var/spool/squid                                        # 崩溃存储目录
使用
    step1 检查配置文件
        squid -k parse
    step2  初始化cache 目录
        squid -z(X)                                # X会显示过程
    step3 启动squid
        service squid start
        或
        /usr/local/squid/sbin/squid -sD
    停止squid
        squid -k shutdown
    重新载入配置
        squid -k reconfigure
    滚动日志
        squid -k rotate
案例
    透明代理
        step1 检查配置文件
            squid -k parse
        step2  初始化cache 目录
            squid -z(X)                                # X会显示过程
        step3 启动squid
            service squid start
            或
            /usr/local/squid/sbin/squid -sD
        停止squid
            squid -k shutdown
        重新载入配置
            squid -k reconfigure
        滚动日志
            squid -k rotate
    代理
        squid.conf
            http_port 3128
            http_access allow all
            或
            http_port 3128
            http_access deny all前面添加
            acl 192.168.0.42 src 192.168.0.0/24
            http_access allow 192.168.0.42                        ＃ 192.168.0.42为允许的ip


  LVS
  #

介绍
    第四层开始负载(可以建立到三层负载)

    第四层负载
        socket进必须连lvs

模式
    tun
        # lvs负载均衡器将请求包发给物理服务器，后者将应答包直接发给用户
    net
        # 请求和应答都经过lvs
    dr
        # 不要隧道结构的tun
使用
    DR模式 centos6
    yum install-y gcc gcc-c&#43;&#43; makepcre pcre-devel kernel-devel openssl-devel libnl-devel popt-devel
    modprobe -l |grep ipvs
        # 检查内核是否集成
    echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward
        # 开启路由转发
    安装ipvsadm
        http://www.linuxvirtualserver.org/software/kernel-2.6/ipvsadm-1.26.tar.gz
    安装keepalived
        http://www.keepalived.org/software/keepalived-1.2.7.tar.gz
        ./configure --prefix=/usr/local/keepalived

        cp  /usr/local/keepalived/etc/rc.d/init.d/keepalived        /etc/init.d/
        cp /usr/local/keepalived/etc/sysconfig/keepalived        /etc/sysconfig/
        mkdir /etc/keepalived/
        cp /usr/local/keepalived/etc/keepalived/keepalived.conf        /etc/keepalived/
        cp /usr/local/keepalived/sbin/keepalived        /usr/sbin/

        o-&gt; 配置文件/etc/keepalived/keepalived.conf
        ! Configuration File forkeepalived
        global_defs {
        notification_email {
        test@sina.com    #故障接受联系人
        }
        notification_email_from admin@test.com  #故障发送人
        smtp_server 127.0.0.1  #本机发送邮件
        smtp_connect_timeout 30
        router_id LVS_MASTER  #BACKUP上修改为LVS_BACKUP
        }
        vrrp_instance VI_1 {
        state MASTER    #BACKUP上修改为BACKUP
        interface eth0
        virtual_router_id 51  #虚拟路由标识，主从相同
        priority 100  #BACKUP上修改为90
        advert_int 1
        authentication {
        auth_type PASS
        auth_pass 1111  #主从认证密码必须一致
        }
        virtual_ipaddress {    #Web虚拟IP（VTP）
        172.0.0.10
        }
        }
        virtual_server 172.0.0.10 80 { #定义虚拟IP和端口
        delay_loop 6    #检查真实服务器时间，单位秒
        lb_algo rr      #设置负载调度算法，rr为轮训
        lb_kind DR      #设置LVS负载均衡DR模式
        persistence_timeout 50 #同一IP的连接60秒内被分配到同一台真实服务器
        protocol TCP    #使用TCP协议检查realserver状态
        real_server 172.0.0.13 80 {  #第一个web服务器
        weight 3          #节点权重值
        TCP_CHECK {      #健康检查方式
        connect_timeout 3 #连接超时
        nb_get_retry 3    #重试次数
        delay_before_retry 3  #重试间隔/S
        }
        }
        real_server 172.0.0.14 80 {  #第二个web服务器
        weight 3
        TCP_CHECK {
        connect_timeout 3
        nb_get_retry 3
        delay_before_retry 3
            }
        }
        }

        service keepalived restart

    启动脚本 /etc/init.d/real.sh
        #description : start realserver
        VIP=172.0.0.10
        . /etc/init.d/functions
        case &quot;$1&quot; in
        start)
        /sbin/ifconfig lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up
        echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore
        echo &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce
        echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore
        echo &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_announce
        echo &quot;LVS RealServer Start OK&quot;
        ;;
        stop)
        /sbin/ifconfig lo:0 down
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_announce
        echo &quot;LVS RealServer Stoped OK&quot;
        ;;
        *)
        echo &quot;Usage: $0 {start|stop}&quot;
        exit 1
        esac

    o-&gt; 开机启动
        chmod &#43;x /etc/init.d/real.sh
        /etc/init.d/real.sh start
        echo &quot;/etc/init.d/real.sh start&quot; &gt;&gt; /etc/rc.local
    o-&gt; 测试
        service httpd start
        echo &quot;1&quot; &gt; /var/www/html/index.html
        service iptables stop
        setenforce 0
            # 关闭selinux
    o-&gt; 其他命令
        ipvsadm -ln
            # 集群中服务器ip信息
        ip addr
            # 显示VIP当前绑定的服务器
        tail -f /var/log/messages
            # 日志


  数据库
  #


  读写分离
  #

MySQL主从复制
Haproxy &#43; 多Slave
DRBD &#43; Heartbeat &#43; MySQL
MySQL Cluster


  分片
  #

问题
    事务
    Join
    迁移
    扩容
    ID生成
    分页
方案
    事务补偿        # 数据对账：基于日志对比、同步标准数据源
    分区            # MySQL机制分文件存储，客户端无感知
    分表            # 客户端管理分表路由
    分库
        为什么 
            单库无法承接连接数时分库，MySQL单库5千万条，Oracle单库一亿条
        策略
            数值范围
            取模
            日期
框架
    Sharding-JDBC
    TSharding
代理
    Atlas
    MyCAT
    Vitess


  分布式文件系统
  #

HDFS            # 批量读写，高吞吐量，不适合小文件
FastDFS         # 轻量级，适合小文件


  一致性
  #

CAP
    一致性
        强一致性、弱一致性（秒级），最终一致性
    可用性
    分区容错性（网络故障）
BASE
    Basically Available（基本可用），Soft state（软状态），Eventually consistent（最终一致性）
幂等性


  分布式锁
  #

算法
    PAXOS
    Zab
        # Zookeeper使用
    Raft
        # 三角色：Leader（领袖），Follower（群众），Candidtate（候选人）
    Gossip
        # Cassandra使用
实现方式
    数据库
        有单点问题
    缓存
        非阻塞性能好
        有锁不释放问题
        实现
            RedLock setnx
            Memcached add
    Zookeeper
        有序临时节点，集群透明解决单点问题，锁被释放，锁可重入
        性能不如缓存，吞吐量随集群规模变大而下降


  一致性哈希
  #

扩容映射


  分布式事务
  #

分类
    两阶段提交、多阶段提交
    TCC事务


  Atomikos
  #


  ID生成器
  #

Snowflake算法           # Twitter
    41位时间戳&#43;10位机器标识（比如IP，服务器名称等）&#43;12位序列号(本地计数器)
MySQL自增ID &#43; &quot;REPLACE INTO XXX:SELECT LAST_INSERT_ID();&quot;
    # Flicker
MongoDB ObjectId
    不能自增
UUID
    无序，过长，影响检索性能
">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://runout.run/docs/middleware/distributed/">
  <meta property="og:site_name" content="outrun的笔记">
  <meta property="og:title" content="支撑-分布式">
  <meta property="og:description" content="名词 # Alb automaticLoopBack 自动回环，虚拟接口 sdn software defined network 软件定义网络 Serverless # knative # google开源，serverless标准化方案，基于kubernetes和istio 模块 build serving eventing ServiceMesh # Service Fabric # # 微软 Istio # #google IBM, lyft开源，基于envoy 组成 数据面板 控制面板 Knative # 介绍 管理kubernetes, Istio 模块 build serve config route event Traefik # # go实现，多后台如kubernetes, swarm, marathon, mesos Linkerd # # buoyant出品 Conduit # # 面向kubernetes轻量化mesh Fingle # # twitter出品 Envoy # # lyft出品 Nginmesh # # nginx推出 PaaS # # platform as a service CloudStack # # 托管在apache的开源、高可用、高扩展性的云计算平台 # 支持主流hypervisors # 一个开源云计算解决方案，可以加速iaaS的部署、管理、配置 CloudFoundry # # pivotal开源, 根据应用模板，动态生成很多tomcat, mysql, nosql, 动态控制这些实例的启停。 OpenStack # # 云操作系统，管理虚拟资源 Container Orchestration # 特性 dubbo spring cloud kubernetes 配置管理 - config kubernetes configMap 服务发现 zookeeper eureka, consul, zookeeper kubernetes services 负载均衡 自带 ribbon kubernetes services 网关 - zuul kubernetes services 分布式追踪 - spring cloud sleuth open tracing 容错 不完善 hystrix kubernetes health check 通信方式 rpc http, message 安全模块 - spring cloud security - 分布式日志 ELK EFK 任务管理 spring batch kubernetes jobs Kubernetes # # google开源的，borg的发展，在docker技术上，管理容器化应用 特点 不限语言 无侵入, 服务只写业务 适合微服务 # 调整服务副本数, 横向扩容 无缝迁移到公有云 # cluster ip实现不改配置迁移 自动化资源管理 服务发现，用dns解析服务名 内嵌负载均衡 部署实施 治理 监控 故障发现、自我修复 透明服务注册、发现 服务滚动升级、在线扩容, 根据负载自动扩容缩容 可扩展资源自动调度、多粒度资源配额 多层安全防护、准入 多租户 完善的工具 pod运行容器 etcd保存所有状态 架构 cluster master api server # 对外http rest接口, 管理资源对象(pod, RC, service)增删改查 controller manager # 管理控制器, node, pod, endpoint, namespace, serviceAccount, resourceQuota自动化管理 scheduler # 接收controller manager命令执行pod调度 etcd # 配置 node # 一master多node 特点 node宕机，pod调度到其它节点 pod # 一node几百个pod, 基本操作单元，代表一个运行进程，内部封装一个(或多个紧密相关的)容器。 特点 pod内通信高效，放密切相关服务进程 可以判断一组相关容器的状态(用pause) pause解决共享ip、容器通信、共享文件的问题 pod间通信用虚拟二层协议(flannel, openvswitch)实现 普通pod在etcd存储，再调度到某node实例化，静态pod在node中存储，在node实例化 对pod可进行资源(cpu,内存)限额 label # 标签，用标签选择器选择。key和value由用户指定，可附加到node, pod, service, rc等 pause容器 # 根容器，共享网络栈、挂载卷 docker/rocket # 容器 kubelet # master监视pod, 创建、修改、监控、删除 kube-proxy # 代理pod接口 fluentd # 日志收集、存储、查询 kube-dns # 服务dns解析 概念 service # 服务网关 特点 唯一名字 唯一虚拟ip(cluster ip, service ip, vip) # 可多端口，每端口有名字 提供远程服务 # 目前socket 应用到一组pod event # 探针检测失败记录，用于排查故障 rc # replication controller 副本数 筛选标签 pod模板 改变pod镜像版本，滚动升级 replica set # 1.2 rc升级, 支持基于集合的标签选择。被deployment使用 deployment # pod编排, rc升级 特点 查看pod部署进度 HPA # horizontal pod autoscaler, 自动扩容缩容 指标 cpu utilization percentage # 1分钟内利用率平均值 应用自定义指标(tps, qps) volume emptyDir hostPath gcePersistentDisk awsElasticBlockStore NFS persistent volume namespace annotation 动作 扩容 创建rc自动创建pod, 调度到合适的node pod定义 副本数 监控label # 筛选pod得到数量 命令 kubectl --help # 帮助, 各命令之后都可加 version cluster-info logs kubectl logs --tail=1000 appID1 # 查看日志 run exec kubectl exec -it appID1 /bin/sh # 交互命令进入app create -f mysql-rc.yaml # 创建rc -f mysql-svc.yaml # 创建service set image get rc # 查看rc pods pod -o wide # 显示详情，有node name o-&gt; kubectl get pod -l app=app1 -o wide # 查看pod app状态 services svc # 查看service, 包含cluster ip nodes endpoints # service pod的ip:端口 deployments describe # 详情 node pods deployments expose label delete scale # pod扩容或缩容 --replicas=2 autoscale # 创建hpa对象 deployment rolling-update # pod滚动升级 rollout status undo apply # 应用配置 -f proxy kubelet kube-apiserver kube-proxy kube-scheduler kubeadm kube-controller-manager hyperkube apiextensions-apiserver mounter 镜像 kube-apiserver kube-controller-manager kube-scheduler kube-proxy pause etcd coredns 配置 用yaml或json定义 pod kind: Pod # 表明是Pod metadata: name: myweb # pod名 labels: name: myweb # 标签 Spring Cloud # Mesos # # twitter, apache开源的分布式资源管理框架, 两级调度器 Dubbo # 介绍 阿里开源，分布式服务框架，rpc方案，soa治理 功能 远程通讯 # 多协议，多种长连接nio框架封装 集群容错 # 负载均衡，容错，地址路由，动态配置 自动发现 # 注册中心 节点 容器(container) 提供者(provider) 消费者(consumer) 注册中心(registry) 监控中心(monitor) 调用关系 容器启动提供者 提供者注册 消费者订阅 注册中心返回地址列表, 长连接更新 消费者软负载均衡挑选列表中提供者 提供者和消费者累计调用次数和时间，定时发送到监控中心 容错机制 failover # 默认，失败自动切换 failfast # 立即报错，用于幂等写操作 failsafe # 忽略 failback # 定时重发 forking # 并行多个取最快(any) broadcast # 逐个多个，异常退出 连接方式 广播 # 不需要中心节点，适用开发测试, 地址段224.0.0.0 - 239.255.255.255 服务端配置 applicationContext-service.xml &lt;dubbo:application name=”taotao-manager-service” /&gt; &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt; &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt; &lt;dubbo:service interface=”com.taotao.manager.service.TestService” ref=”testServiceImpl” /&gt; 客户端配置 springMVC.xml &lt;dubbp:application name=”taotao-manager-web” /&gt; &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt; &lt;dubbo:service interface=”com.taotao.manager.service.TestService” id=”testService” timeout=”10000000” /&gt; 直连 服务端配置 &lt;dubbo:application name=”taotao-manager-service” /&gt; &lt;dubbo:registry address=”N/A” /&gt; &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt; &lt;dubbo:service interface=”com.taotao.manager.service.TestService” ref=”testServiceImpl” /&gt; applicationContext-service.xml 客户端配置 springMVC.xml &lt;dubbp:application name=”taotao-manager-web” /&gt; &lt;dubbo:service interface=”com.taotao.manager.service.TestService” id=”testService” timeout=”10000000” /&gt; 注册中心 zookeeper Dubbox # 介绍 当当网扩展Dubbo Netflix OSS # orleans # # .NET HSF # # high-speed service framework, 阿里出品， socket直连 特点 不增加中间点(稳定，高度可伸缩) 结构 注册服务信息，推送服务地址 基于osgi 组件 服务提供者 消费者 地址服务器 配置服务器 # 分布式配置 规则服务(diamond) # 设置(黑白名单，认证，权重，限流)与推送 NScale # # 可扩展容器，用node.js和docker实现 Armada # # python微服务 SOA # # 面向服务架构 service oriented architecture EAI # # Enterprise Application Integration 建立底层结构将异构应用集成 ESB # # Enterprise Service Bus 企业服务总线， 是连接中枢 RPC # # 远程过程调用 remote procedure call Thrift # CXF # 常识 自己内部整合spring(但是不耦合) 支持的协议 soap1.1/1.2 post/http restful http 使用 导入cxf包 方法1 # 不支持注解 String address=&#34;http://localhost:8888/hello&#34;; ServerFactoryBean factoryBean=new ServerFactoryBean(); factoryBean.setAddress(address); factoryBean.setServiceBean(new MyWS()); factoryBean.create(); 方法2 # 支持注解,wsdl文件中类型不再单独schema文件 ServerFactoryBean factoryBean = new JaxWsServerFactoryBean # java and xml web service 日志 # 记录握手信息(访问wsdl文件) ## 看日志记录得到 soap serverFactoryBean.getInInterceptors().add(new LoggingInInterceptor()); serverFactoryBean.getOutInterceptors().add(new LoggingOutInterceptor()); 整合spring o-&gt; cxf2.4.4.jar/schemas/jaxws.xsd中找到命名空间&#34;http://cxf.apache.org/jaxws&#34; o-&gt; 配置applicationContext.xml，加入cxf的命名空间http://cxf.apache.org/jaxws,schema地址为http://cxf.apache.org/schemas/jaxws.xsd。 并且在eclipse中配置schema约束文件的路径 # 该xsd约束文件的url地址用的是包地址,不规范 o-&gt; applicationContext.xml中配置 &lt;bean id=&#34;studentService&#34; class=&#34;test.spring.StudentServiceImpl&#34;/&gt; # 用于：自身调用，被spring引用 &lt;jaxws:server serviceClass=&#34;test.spring.StudentService&#34; address=&#34;/student&#34;&gt; # address配置服务的名称即可(web.xml的servlet中配置了服务的实际访问地址) ## serviceClass配置的才是真正的服务，既然它是接口，那么webService注解也应该写在接口上 &lt;jaxws:serviceBean&gt; &lt;ref bean=&#34;studentService&#34;/&gt; &lt;jaxws:inInterceptors&gt; &lt;bean class=&#34;org.apache.cxf.interceptor.LoggingInInterceptor&#34; /&gt; &lt;jaxws:outInterceptors&gt; &lt;bean class=&#34;org.apache.cxf.interceptor.LoggingOutInterceptor&#34; /&gt; o-&gt; web.xml中配置servlet &lt;servlet&gt; &lt;servlet-name&gt;springWS &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet # 在cxf-2.4.4.jar包中 &lt;load-on-startup&gt;1 &lt;servlet-mapping&gt; &lt;servlet-name&gt;springWS &lt;url-pattern&gt;/ws/* o-&gt; web.xml中配置spring监听器 GRPC # Protobuf # # 通信协议 命令 protoc -I. -I-I$GOPATH/src --go_out=plugins=grpc:. * # -I import目录 protoc --grpc-gateway_out=. 插件 安装 # go build 出protoc-gen-go后，放入go/bin下 protoc-gen-go # 编译proto文件 protoc-gen-grpc-gateway # http服务 RMI # # java远程调用 remote method invocation Hessian # # 是caucho公司的开源协议,基于http Burlap # # caucho公房的开源协议,基于http HttpInvoker # # spring提供的协议，必须用spring Web Service # # soap通讯 粘合层 # 治理(服务发现) # Zookeeper # 介绍 google chubby的开源实现。用于服务发现 保证CP 分布式, hadoop中hbase的组件 fast paxos算法 # paxos存在活锁问题, fast paxos通过选举产生leader, 只有leader才能提交proposer 功能 配置维护 域名服务 分布式同步 组服务 分布式独享锁、选举、队列 流程 选举leader # 多种算法, leader有最高执行ID 同步数据 大多数机器得到响应follow leader exhibitor # supervisor for zk Eureka # # Netflix，保证AP Consul # # Apache，保证CA Etcd # # kubernetes用，保证CP 路由控制 # 负载均衡策略 随机、轮询、调用延迟判断、一致性哈希、粘滞连接 本地路由优先策略 优先JVM（injvm），优先相同物理机（innative） 配置方式 统一注册表、本地配置、动态下发 配置 # Spring Cloud Config # Diamond # # 淘宝 Archaius # # netflix Disconf # # 百度 QConf # # 360 任务 # Elastic-Job # # 当当网 Azkaban # # linkedin Spring Cloud Task # 跟踪 # zipkin # # twitter Opentracing # Hydra # # 京东 Spring Cloud Sleuth # 监控 # Spy.js # # webstorm用的监控工具 Alinode # # 朴灵写的运行时性能管理工具 OneAPM # # 监控node性能 功能 接口响应时间 数据库方法时间 外部服务时间 单请求的耗时比 容错 # Hystrix # 功能 服务线程隔离、信号量隔离 降级: 超时、资源不足 熔断: 自动降级、快速恢复 请求缓存、请求合并 代理 # Gearman # # 分布式计算, 把工作委派给其他机器 Hazelcast # # 基于内存的数据网格，用于分布式计算 Twemproxy # redis/memcache分片代理 高可用 # # high-availability linux 目标 reliability: 可靠性 availability: 可用性 serviceability: 可服务性 ras: remote access service(远程服务访问) 术语 节点(node): 唯一主节点，多个备用节点 资源(resource): 是节点可控制的实体，主节点发生故障时，可以被其它节点接管 例如: 磁盘分区 文件系统 ip地址 应用程序服务 nfs文件系统 事件(event): 集群中可能发生的事件 例如: 系统故障 网络连通故障 网卡故障 应用程序故障 动作(action): 事件发生时ha的响应方式 例如: 用shell 脚本对资源进行转移 心跳 # HeartBeat # 2.0模块 heartbeat: 节点间通信检测模块 ha-logd: 集群事件日志服务 CCM(Consensus CLuster Membership): 集群成员一致性管理模块 LRM(Local Resource Manager): 本地资源管理模块 Stonith Daemon: 使出现问题的节点从集群资源中脱离 CRM(Cluster Resource management): 集群资源管理模块 Cluster policy engine: 集群策略引擎 用于实现节点与资源之间的管理与依赖关系 Cluster transition engine: 集群转移引擎 3.0拆分之后的组成部分 Heartbeat: 负责节点之间的通信 Cluster Glue: 中间层，关联Heartbeat 与 Pacemaker,包含LRM 与 stonith Resource Agent: 控制服务启停，监控服务状态脚本集合，被LRM调用 Pacemaker: 也就是曾经的CRM，包含了更多的功能 管理接口: crm shell 一个使用ajax web 的web窗口 hb_gui图形工具 DRBD-MC, 一个基于java的工具 版本差异 与1.x相比，2.1.x版本变化 保留原来所有功能 自动监控资源 对各资源组进行独立监控 同时监控系统负载 自动切换到负载低的node上 Keepalived # vrrp # virtual router redundancy protocol 虚拟路由器冗余协议 # 解决静态路由出现的闪单点故障问题，它能够保证网络的不间断．稳定运行 负载 # # load balance 方法 dns轮循 java nio erlang语言 linux epoll bsd kqueue 消息队列、事件通知 c/c&#43;&#43;下ace, boost.asio, libev(libevent) 服务器mina, jetty, node.js, netty java协程框架 quasar kilim Haproxy # 监控页面 /status Tengine # # 淘宝基于nginx修改，添加了功能 监控 /upstream_status OpenResty # # 淘宝改的nginx, lua工具 安装 yum install -y gcc gcc-c&#43;&#43; kernel-devel readline-devel pcre-devel openssl-devel openssl zlib zlib-devel pcre-devel wget openresty-1.9.15.1.tar.gz ./configure --prefix=/opt/openresty --with-pcre-jit --with-ipv6 --without-http_redis2_module --with-http_iconv_module -j2 make &amp;&amp; make install ln -s /opt/openresty/nginx/sbin/nginx /usr/sbin /opt/openresty/nginx/conf/nginx.conf Varnish # # 反向代理, http缓存 Traffic Server # # apache 缓存 Squid # 配置文件 /etc/squid/squid.conf 代理类型 普通代理 透明代理 反向代理 缓存 动态资源 静态资源 参考资料 squid 透明代理详解 配置 # squid.conf http_port 3128 # squid服务端口 icp_port 3130 # udp端口,用来接收和发送ICP消息 cache_dir ufs /var/spool/squid # 缓存目录, 写入方式有aufs与ufs两种,aufs使用大量线程异步进行磁盘i/o操作 cache_access_log /var/log/squid/access.log cache_log /var/log/squid/cache.log cache_store_log /var/log/squid/store.log pid_filename /var/run/squid.pid # 日志文件位置 #auth_param basic children 5 #auth_param basic realm Squid proxy-caching web server #auth_param basic credentialsttl 2 hours # 关闭认证，认证一般不需要 cache_effective_user squid cache_effective_group squid cache_mgr youraccount@your.e.mail # 设置squid用户及用户组、管理员账号 cache_mem 128 MB # 运行内存配置 cache_swap_low 90 cache_swap_high 95 maximum_object_size 4096 KB ＃ 与磁盘容量相关的配置，90、95为百分比，磁盘大时4096 KB可以改成32768 KB maximum_object_size_in_memory 8 KB ＃ 内存缓存资料大小 以下为定义acl(访问控制列表) ＃ 语法为:acl&lt;acl&gt; &lt;acl名称&gt; &lt;acl类型&gt; &lt;配置的内容&gt; acl All src 0/0 acl Manager proto cache_object acl Localhost src 127.0.0.1/32 acl Safe_ports port 80 21 443 563 70 210 280 488 591 777 1025-65535 acl SSL_ports 443 563 acl CONNECT method CONNECT acl MyNetwork src 192.168.0.0/16 以下为利用前面定义的acl,定义访问控制规则 http_access allow Manager Localhost http_access deny Manager http_access deny !Safe_ports http_access deny CONNECT SSL_ports http_access allow MyNetwork http_access deny All 例子: 禁止访问sina acl sina dstdomain .sina.com.cn .sina.com http_access deny sina 或 acl sina dst 58.63.236.26 58.63.236.27 58.63.236.28 58.63.236.29 58.63.236.30 58.63.236.31 58.63.236.32 58.63.236.33 58.63.236.34 58.63.236.35 58.63.236.36 58.63.236.37 58.63.236.38 58.63.236.39 58.63.236.49 58.63.236.50 http_access deny sina 或 acl sina dst www.sina.com.cn http_access deny sina 例子: 禁止来自某些ip的访问 acl zhang src 192.168.63.6/32 http_access deny zhang 例子: 禁止在某些时段访问 acl Working_hours MTWHF 08:00-17:00 http_access allow Working_hours http_access deny !Working_hours 例子: 禁止某个代理客户建立过多连接 acl OverConnLimit maxconn http_access deny OverConnLimit 定义与其它代理服务器的关系,语法: &lt;cache_peer&gt; &lt;主机名称&gt; &lt;类别&gt; &lt;http_port&gt; &lt;icp_port&gt; &lt;其它参数&gt; cache_peer 192.168.60.6 parent 4480 7 no-query default #设置与其它代理服务器的关系: &lt;cache_peer_access&gt; &lt;上层 Proxy &gt; &lt;allow|deny&gt; &lt;acl名称&gt; #cache_peer_access 192.168.60.6 allow aclxxx #cache_peer_access 192.168.60.6 deny !aclxxx coredump_dir /var/spool/squid # 崩溃存储目录 使用 step1 检查配置文件 squid -k parse step2 初始化cache 目录 squid -z(X) # X会显示过程 step3 启动squid service squid start 或 /usr/local/squid/sbin/squid -sD 停止squid squid -k shutdown 重新载入配置 squid -k reconfigure 滚动日志 squid -k rotate 案例 透明代理 step1 检查配置文件 squid -k parse step2 初始化cache 目录 squid -z(X) # X会显示过程 step3 启动squid service squid start 或 /usr/local/squid/sbin/squid -sD 停止squid squid -k shutdown 重新载入配置 squid -k reconfigure 滚动日志 squid -k rotate 代理 squid.conf http_port 3128 http_access allow all 或 http_port 3128 http_access deny all前面添加 acl 192.168.0.42 src 192.168.0.0/24 http_access allow 192.168.0.42 ＃ 192.168.0.42为允许的ip LVS # 介绍 第四层开始负载(可以建立到三层负载) 第四层负载 socket进必须连lvs 模式 tun # lvs负载均衡器将请求包发给物理服务器，后者将应答包直接发给用户 net # 请求和应答都经过lvs dr # 不要隧道结构的tun 使用 DR模式 centos6 yum install-y gcc gcc-c&#43;&#43; makepcre pcre-devel kernel-devel openssl-devel libnl-devel popt-devel modprobe -l |grep ipvs # 检查内核是否集成 echo &#34;1&#34; &gt; /proc/sys/net/ipv4/ip_forward # 开启路由转发 安装ipvsadm http://www.linuxvirtualserver.org/software/kernel-2.6/ipvsadm-1.26.tar.gz 安装keepalived http://www.keepalived.org/software/keepalived-1.2.7.tar.gz ./configure --prefix=/usr/local/keepalived cp /usr/local/keepalived/etc/rc.d/init.d/keepalived /etc/init.d/ cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/ mkdir /etc/keepalived/ cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/ cp /usr/local/keepalived/sbin/keepalived /usr/sbin/ o-&gt; 配置文件/etc/keepalived/keepalived.conf ! Configuration File forkeepalived global_defs { notification_email { test@sina.com #故障接受联系人 } notification_email_from admin@test.com #故障发送人 smtp_server 127.0.0.1 #本机发送邮件 smtp_connect_timeout 30 router_id LVS_MASTER #BACKUP上修改为LVS_BACKUP } vrrp_instance VI_1 { state MASTER #BACKUP上修改为BACKUP interface eth0 virtual_router_id 51 #虚拟路由标识，主从相同 priority 100 #BACKUP上修改为90 advert_int 1 authentication { auth_type PASS auth_pass 1111 #主从认证密码必须一致 } virtual_ipaddress { #Web虚拟IP（VTP） 172.0.0.10 } } virtual_server 172.0.0.10 80 { #定义虚拟IP和端口 delay_loop 6 #检查真实服务器时间，单位秒 lb_algo rr #设置负载调度算法，rr为轮训 lb_kind DR #设置LVS负载均衡DR模式 persistence_timeout 50 #同一IP的连接60秒内被分配到同一台真实服务器 protocol TCP #使用TCP协议检查realserver状态 real_server 172.0.0.13 80 { #第一个web服务器 weight 3 #节点权重值 TCP_CHECK { #健康检查方式 connect_timeout 3 #连接超时 nb_get_retry 3 #重试次数 delay_before_retry 3 #重试间隔/S } } real_server 172.0.0.14 80 { #第二个web服务器 weight 3 TCP_CHECK { connect_timeout 3 nb_get_retry 3 delay_before_retry 3 } } } service keepalived restart 启动脚本 /etc/init.d/real.sh #description : start realserver VIP=172.0.0.10 . /etc/init.d/functions case &#34;$1&#34; in start) /sbin/ifconfig lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up echo &#34;1&#34; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore echo &#34;2&#34; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce echo &#34;1&#34; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore echo &#34;2&#34; &gt;/proc/sys/net/ipv4/conf/all/arp_announce echo &#34;LVS RealServer Start OK&#34; ;; stop) /sbin/ifconfig lo:0 down echo &#34;0&#34; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore echo &#34;0&#34; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce echo &#34;0&#34; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore echo &#34;0&#34; &gt;/proc/sys/net/ipv4/conf/all/arp_announce echo &#34;LVS RealServer Stoped OK&#34; ;; *) echo &#34;Usage: $0 {start|stop}&#34; exit 1 esac o-&gt; 开机启动 chmod &#43;x /etc/init.d/real.sh /etc/init.d/real.sh start echo &#34;/etc/init.d/real.sh start&#34; &gt;&gt; /etc/rc.local o-&gt; 测试 service httpd start echo &#34;1&#34; &gt; /var/www/html/index.html service iptables stop setenforce 0 # 关闭selinux o-&gt; 其他命令 ipvsadm -ln # 集群中服务器ip信息 ip addr # 显示VIP当前绑定的服务器 tail -f /var/log/messages # 日志 数据库 # 读写分离 # MySQL主从复制 Haproxy &#43; 多Slave DRBD &#43; Heartbeat &#43; MySQL MySQL Cluster 分片 # 问题 事务 Join 迁移 扩容 ID生成 分页 方案 事务补偿 # 数据对账：基于日志对比、同步标准数据源 分区 # MySQL机制分文件存储，客户端无感知 分表 # 客户端管理分表路由 分库 为什么 单库无法承接连接数时分库，MySQL单库5千万条，Oracle单库一亿条 策略 数值范围 取模 日期 框架 Sharding-JDBC TSharding 代理 Atlas MyCAT Vitess 分布式文件系统 # HDFS # 批量读写，高吞吐量，不适合小文件 FastDFS # 轻量级，适合小文件 一致性 # CAP 一致性 强一致性、弱一致性（秒级），最终一致性 可用性 分区容错性（网络故障） BASE Basically Available（基本可用），Soft state（软状态），Eventually consistent（最终一致性） 幂等性 分布式锁 # 算法 PAXOS Zab # Zookeeper使用 Raft # 三角色：Leader（领袖），Follower（群众），Candidtate（候选人） Gossip # Cassandra使用 实现方式 数据库 有单点问题 缓存 非阻塞性能好 有锁不释放问题 实现 RedLock setnx Memcached add Zookeeper 有序临时节点，集群透明解决单点问题，锁被释放，锁可重入 性能不如缓存，吞吐量随集群规模变大而下降 一致性哈希 # 扩容映射 分布式事务 # 分类 两阶段提交、多阶段提交 TCC事务 Atomikos # ID生成器 # Snowflake算法 # Twitter 41位时间戳&#43;10位机器标识（比如IP，服务器名称等）&#43;12位序列号(本地计数器) MySQL自增ID &#43; &#34;REPLACE INTO XXX:SELECT LAST_INSERT_ID();&#34; # Flicker MongoDB ObjectId 不能自增 UUID 无序，过长，影响检索性能">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">
<title>支撑-分布式 | outrun的笔记</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.dc9a8161e6c374f95d1e4ce6b94723a050d02b08398745f1301dbdde08c5b9f0.js" integrity="sha256-3JqBYebDdPldHkzmuUcjoFDQKwg5h0XxMB293gjFufA=" crossorigin="anonymous"></script>
<link rel="alternate" type="application/rss+xml" href="https://runout.run/docs/middleware/distributed/index.xml" title="outrun的笔记" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <script data-ad-client="ca-pub-6239994681364905" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<meta name="baidu_union_verify" content="aacbc30462cce84b2333063d99284e3b">
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>outrun的笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  <ul>
<li><a href="/"><strong>介绍</strong></a></li>
<li><a href="/docs/architect"><strong>架构</strong></a>
<ul>
<li><a href="/docs/architect/method"><strong><strong>规划与方法</strong></strong></a>
<ul>
<li><a href="/docs/architect/method/product_plan">产品规划</a></li>
<li><a href="/docs/architect/method/advice_plan">咨询规划</a></li>
<li><a href="/docs/architect/method/test_plan">测试规划</a></li>
<li><a href="/docs/architect/method/architect">服务治理</a></li>
<li><a href="/docs/architect/method/ops_plan">运维规划</a></li>
<li><a href="/docs/architect/method/project_plan">项目规划</a></li>
<li><a href="/docs/architect/method/code_plan">代码规划</a></li>
</ul>
</li>
<li><a href="/docs/architect/strategy"><strong><strong>战略技术方案</strong></strong></a>
<ul>
<li><a href="/docs/architect/strategy/middle_platform"><strong><strong>中台</strong></strong></a></li>
<li><a href="/docs/architect/strategy/datalake"><strong><strong>湖仓一体</strong></strong></a>
<ul>
<li><a href="/docs/architect/strategy/big_data/ecology">生态体系</a></li>
</ul>
</li>
<li><a href="/docs/architect/strategy/ai"><strong><strong>人工智能</strong></strong></a>
<ul>
<li><a href="/docs/architect/strategy/ai/deep">深度学习</a></li>
<li><a href="/docs/architect/strategy/ai/map">知识图谱</a></li>
</ul>
</li>
<li><a href="/docs/architect/strategy/iot"><strong><strong>物联网</strong></strong></a>
<ul>
<li><a href="/docs/architect/strategy/iot/framework">框架</a></li>
</ul>
</li>
<li><a href="/docs/architect/strategy/block_chain"><strong><strong>区块链</strong></strong></a></li>
<li><a href="/docs/architect/strategy/meta"><strong><strong>元宇宙Web3.0</strong></strong></a>
<ul>
<li><a href="/docs/architect/strategy/meta/media">媒体</a></li>
</ul>
</li>
<li><a href="/docs/architect/strategy/cloud"><strong><strong>云原生</strong></strong></a></li>
<li><a href="/docs/architect/strategy/edge"><strong><strong>边缘计算</strong></strong></a></li>
</ul>
</li>
<li><a href="/docs/architect/project"><strong><strong>工程设计原则</strong></strong></a>
<ul>
<li><a href="/docs/architect/project/ddd">DDD</a></li>
<li><a href="/docs/architect/project/frontend">前端设计</a></li>
</ul>
</li>
<li><a href="/docs/architect/code"><strong><strong>代码原则</strong></strong></a>
<ul>
<li><a href="/docs/architect/code/design_mode">设计模式</a></li>
<li><a href="/docs/architect/code/security">安全/协议</a></li>
</ul>
</li>
<li><a href="/docs/architect/manage"><strong><strong>管理</strong></strong></a>
<ul>
<li><a href="/docs/architect/manage/organize"><strong><strong>组织</strong></strong></a>
<ul>
<li><a href="/docs/architect/manage/organize/people">人员</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/docs/architect/summary">这些年我做过的技术</a></li>
</ul>
</li>
<li><a href="/docs/tool"><strong>工具</strong></a>
<ul>
<li><a href="/docs/tool/linux"><strong><strong>Linux系统</strong></strong></a>
<ul>
<li><a href="/docs/tool/linux/linux_tool">Linux工具</a></li>
<li><a href="/docs/tool/linux/scene">Linux场景</a></li>
<li><a href="/docs/tool/linux/linux_program">Linux系统编程</a></li>
</ul>
</li>
<li><a href="/docs/tool/ops"><strong><strong>运维工具</strong></strong></a>
<ul>
<li><a href="/docs/tool/ops/monitor">监控指标</a></li>
<li><a href="/docs/tool/ops/docker">Docker</a></li>
<li><a href="/docs/tool/ops/k8s">Kubernetes</a></li>
</ul>
</li>
<li><a href="/docs/tool/develop"><strong><strong>开发工具</strong></strong></a>
<ul>
<li><a href="/docs/tool/develop/vim">Vim</a></li>
<li><a href="/docs/tool/develop/eclipse">Eclipse</a></li>
<li><a href="/docs/tool/develop/apple">Apple</a></li>
<li><a href="/docs/tool/develop/jetbrains">Jetbrains</a></li>
</ul>
</li>
<li><a href="/docs/tool/test"><strong><strong>测试工具</strong></strong></a>
<ul>
<li><a href="/docs/tool/test/debug">代码调试</a></li>
</ul>
</li>
<li><a href="/docs/tool/product"><strong><strong>产品工具</strong></strong></a>
<ul>
<li><a href="/docs/tool/product/enterprise_system">企业级系统</a></li>
<li><a href="/docs/tool/product/framework">服务与框架</a></li>
</ul>
</li>
<li><a href="/docs/tool/physics"><strong><strong>实物工具</strong></strong></a></li>
</ul>
</li>
<li><a href="/docs/middleware"><strong>中间件</strong></a>
<ul>
<li><a href="/docs/middleware/container"><strong><strong>容器</strong></strong></a>
<ul>
<li><a href="/docs/middleware/container/nginx">Nginx</a></li>
<li><a href="/docs/middleware/container/nodejs">Node.js</a></li>
</ul>
</li>
<li><a href="/docs/middleware/distributed"><strong><strong>分布式</strong></strong></a>
<ul>
<li><a href="/docs/middleware/distributed/spring_cloud">Spring Cloud</a></li>
</ul>
</li>
<li><a href="/docs/middleware/library"><strong><strong>库</strong></strong></a>
<ul>
<li><a href="/docs/middleware/library/hibernate">Hibernate</a></li>
</ul>
</li>
<li><a href="/docs/middleware/library_frontend"><strong><strong>前端库</strong></strong></a>
<ul>
<li><a href="/docs/middleware/library_frontend/jquery">JQuery</a></li>
<li><a href="/docs/middleware/library_frontend/bootstrap">Bootstrap</a></li>
<li><a href="/docs/middleware/library_frontend/angular">Angular</a></li>
<li><a href="/docs/middleware/library_frontend/react">React</a></li>
<li><a href="/docs/middleware/library_frontend/threejs">Three.js</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/docs/db"><strong>数据库</strong></a>
<ul>
<li><a href="/docs/db/mongodb">MongoDB</a></li>
<li><a href="/docs/db/mysql">Mysql</a></li>
<li><a href="/docs/db/oracle">Oracle</a></li>
<li><a href="/docs/db/postgresql">PgSQL</a></li>
<li><a href="/docs/db/redis">Redis</a></li>
<li><a href="/docs/db/elasticsearch">Elasticsearch</a></li>
</ul>
</li>
<li><a href="/docs/pl"><strong>语言</strong></a>
<ul>
<li><a href="/docs/pl/principle">原理</a></li>
<li><a href="/docs/pl/java"><strong><strong>Java</strong></strong></a>
<ul>
<li><a href="/docs/pl/java/jvm">JVM</a></li>
<li><a href="/docs/pl/java/collection">Java Collection</a></li>
<li><a href="/docs/pl/java/juc">Java Concurrent</a></li>
<li><a href="/docs/pl/java/spring">Spring</a></li>
<li><a href="/docs/pl/java/rxjava">RxJava</a></li>
<li><a href="/docs/pl/java/javaweb">JavaWeb</a></li>
</ul>
</li>
<li><a href="/docs/pl/go">GO</a></li>
<li><a href="/docs/pl/js">JS</a></li>
<li><a href="/docs/pl/python">Python</a></li>
<li><a href="/docs/pl/haskell">Haskell</a></li>
<li><a href="/docs/pl/clojure">Clojure</a></li>
<li><a href="/docs/pl/markup_language"><strong><strong>标记语言</strong></strong></a>
<ul>
<li><a href="/docs/pl/markup_language/html">HTML</a></li>
<li><a href="/docs/pl/markup_language/css">CSS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/docs/basic"><strong>基本功</strong></a>
<ul>
<li><a href="/docs/basic/algorithm"><strong><strong>算法</strong></strong></a>
<ul>
<li><a href="/docs/basic/algorithm/math">数学</a></li>
<li><a href="/docs/basic/algorithm/thought">思想</a></li>
<li><a href="/docs/basic/algorithm/data_structure">数据结构</a></li>
</ul>
</li>
<li><a href="/docs/basic/computer"><strong><strong>计算机</strong></strong></a>
<ul>
<li><a href="/docs/basic/computer/principle">原理</a></li>
<li><a href="/docs/basic/computer/performance">性能</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/docs/cache"><strong>Cache</strong></a>
<ul>
<li><a href="/docs/cache/ops">运维</a></li>
<li><a href="/docs/cache/template">模板配置</a></li>
<li><a href="/docs/cache/soft_arch">软考</a></li>
</ul>
</li>
<li><a href="/docs/misc"><strong>Misc</strong></a></li>
<li><a href="/posts"><strong>Posts</strong></a></li>
</ul>










</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>支撑-分布式</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#名词">名词</a></li>
    <li><a href="#serverless">Serverless</a></li>
    <li><a href="#servicemesh">ServiceMesh</a>
      <ul>
        <li><a href="#service-fabric">Service Fabric</a></li>
        <li><a href="#istio">Istio</a></li>
        <li><a href="#knative">Knative</a></li>
        <li><a href="#traefik">Traefik</a></li>
        <li><a href="#linkerd">Linkerd</a></li>
        <li><a href="#conduit">Conduit</a></li>
        <li><a href="#fingle">Fingle</a></li>
        <li><a href="#envoy">Envoy</a></li>
        <li><a href="#nginmesh">Nginmesh</a></li>
      </ul>
    </li>
    <li><a href="#paas">PaaS</a>
      <ul>
        <li><a href="#cloudstack">CloudStack</a></li>
        <li><a href="#cloudfoundry">CloudFoundry</a></li>
        <li><a href="#openstack">OpenStack</a></li>
      </ul>
    </li>
    <li><a href="#container-orchestration">Container Orchestration</a>
      <ul>
        <li><a href="#kubernetes">Kubernetes</a></li>
        <li><a href="#spring-cloud">Spring Cloud</a></li>
        <li><a href="#mesos">Mesos</a></li>
        <li><a href="#dubbo">Dubbo</a></li>
        <li><a href="#dubbox">Dubbox</a></li>
        <li><a href="#netflix-oss">Netflix OSS</a></li>
        <li><a href="#orleans">orleans</a></li>
        <li><a href="#hsf">HSF</a></li>
        <li><a href="#nscale">NScale</a></li>
        <li><a href="#armada">Armada</a></li>
      </ul>
    </li>
    <li><a href="#soa">SOA</a>
      <ul>
        <li><a href="#eai">EAI</a></li>
        <li><a href="#esb">ESB</a></li>
      </ul>
    </li>
    <li><a href="#rpc">RPC</a>
      <ul>
        <li><a href="#thrift">Thrift</a></li>
        <li><a href="#cxf">CXF</a></li>
        <li><a href="#grpc">GRPC</a></li>
        <li><a href="#protobuf">Protobuf</a></li>
      </ul>
    </li>
    <li><a href="#rmi">RMI</a>
      <ul>
        <li><a href="#hessian">Hessian</a></li>
        <li><a href="#burlap">Burlap</a></li>
        <li><a href="#httpinvoker">HttpInvoker</a></li>
        <li><a href="#web-service">Web Service</a></li>
      </ul>
    </li>
    <li><a href="#粘合层">粘合层</a>
      <ul>
        <li><a href="#治理服务发现">治理(服务发现)</a>
          <ul>
            <li><a href="#zookeeper">Zookeeper</a></li>
            <li><a href="#eureka">Eureka</a></li>
            <li><a href="#consul">Consul</a></li>
            <li><a href="#etcd">Etcd</a></li>
          </ul>
        </li>
        <li><a href="#路由控制">路由控制</a></li>
        <li><a href="#配置">配置</a>
          <ul>
            <li><a href="#spring-cloud-config">Spring Cloud Config</a></li>
            <li><a href="#diamond">Diamond</a></li>
            <li><a href="#archaius">Archaius</a></li>
            <li><a href="#disconf">Disconf</a></li>
            <li><a href="#qconf">QConf</a></li>
          </ul>
        </li>
        <li><a href="#任务">任务</a>
          <ul>
            <li><a href="#elastic-job">Elastic-Job</a></li>
            <li><a href="#azkaban">Azkaban</a></li>
            <li><a href="#spring-cloud-task">Spring Cloud Task</a></li>
          </ul>
        </li>
        <li><a href="#跟踪">跟踪</a>
          <ul>
            <li><a href="#zipkin">zipkin</a></li>
            <li><a href="#opentracing">Opentracing</a></li>
            <li><a href="#hydra">Hydra</a></li>
            <li><a href="#spring-cloud-sleuth">Spring Cloud Sleuth</a></li>
          </ul>
        </li>
        <li><a href="#监控">监控</a>
          <ul>
            <li><a href="#spyjs">Spy.js</a></li>
            <li><a href="#alinode">Alinode</a></li>
            <li><a href="#oneapm">OneAPM</a></li>
          </ul>
        </li>
        <li><a href="#容错">容错</a>
          <ul>
            <li><a href="#hystrix">Hystrix</a></li>
          </ul>
        </li>
        <li><a href="#代理">代理</a>
          <ul>
            <li><a href="#gearman">Gearman</a></li>
            <li><a href="#hazelcast">Hazelcast</a></li>
            <li><a href="#twemproxy">Twemproxy</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#高可用">高可用</a>
      <ul>
        <li><a href="#心跳">心跳</a>
          <ul>
            <li><a href="#heartbeat">HeartBeat</a></li>
            <li><a href="#keepalived">Keepalived</a></li>
          </ul>
        </li>
        <li><a href="#负载">负载</a>
          <ul>
            <li><a href="#haproxy">Haproxy</a></li>
            <li><a href="#tengine">Tengine</a></li>
            <li><a href="#openresty">OpenResty</a></li>
            <li><a href="#varnish">Varnish</a></li>
            <li><a href="#traffic-server">Traffic Server</a></li>
            <li><a href="#squid">Squid</a></li>
            <li><a href="#lvs">LVS</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据库">数据库</a>
      <ul>
        <li><a href="#读写分离">读写分离</a></li>
        <li><a href="#分片">分片</a></li>
        <li><a href="#分布式文件系统">分布式文件系统</a></li>
      </ul>
    </li>
    <li><a href="#一致性">一致性</a>
      <ul>
        <li><a href="#分布式锁">分布式锁</a></li>
        <li><a href="#一致性哈希">一致性哈希</a></li>
        <li><a href="#分布式事务">分布式事务</a>
          <ul>
            <li><a href="#atomikos">Atomikos</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#id生成器">ID生成器</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="名词">
  名词
  <a class="anchor" href="#%e5%90%8d%e8%af%8d">#</a>
</h1>
<pre><code>Alb        automaticLoopBack 自动回环，虚拟接口
sdn        software defined network 软件定义网络
</code></pre>
<h1 id="serverless">
  Serverless
  <a class="anchor" href="#serverless">#</a>
</h1>
<pre><code>knative
    # google开源，serverless标准化方案，基于kubernetes和istio
    模块
        build
        serving
        eventing
</code></pre>
<h1 id="servicemesh">
  ServiceMesh
  <a class="anchor" href="#servicemesh">#</a>
</h1>
<h2 id="service-fabric">
  Service Fabric
  <a class="anchor" href="#service-fabric">#</a>
</h2>
<pre><code># 微软
</code></pre>
<h2 id="istio">
  Istio
  <a class="anchor" href="#istio">#</a>
</h2>
<pre><code>#google IBM, lyft开源，基于envoy
组成
    数据面板
    控制面板
</code></pre>
<h2 id="knative">
  Knative
  <a class="anchor" href="#knative">#</a>
</h2>
<pre><code>介绍
    管理kubernetes, Istio
模块
    build
    serve
        config
        route
    event
</code></pre>
<h2 id="traefik">
  Traefik
  <a class="anchor" href="#traefik">#</a>
</h2>
<pre><code># go实现，多后台如kubernetes, swarm, marathon, mesos
</code></pre>
<h2 id="linkerd">
  Linkerd
  <a class="anchor" href="#linkerd">#</a>
</h2>
<pre><code># buoyant出品
</code></pre>
<h2 id="conduit">
  Conduit
  <a class="anchor" href="#conduit">#</a>
</h2>
<pre><code># 面向kubernetes轻量化mesh
</code></pre>
<h2 id="fingle">
  Fingle
  <a class="anchor" href="#fingle">#</a>
</h2>
<pre><code># twitter出品
</code></pre>
<h2 id="envoy">
  Envoy
  <a class="anchor" href="#envoy">#</a>
</h2>
<pre><code># lyft出品
</code></pre>
<h2 id="nginmesh">
  Nginmesh
  <a class="anchor" href="#nginmesh">#</a>
</h2>
<pre><code># nginx推出
</code></pre>
<h1 id="paas">
  PaaS
  <a class="anchor" href="#paas">#</a>
</h1>
<pre><code># platform as a service
</code></pre>
<h2 id="cloudstack">
  CloudStack
  <a class="anchor" href="#cloudstack">#</a>
</h2>
<pre><code># 托管在apache的开源、高可用、高扩展性的云计算平台
# 支持主流hypervisors
# 一个开源云计算解决方案，可以加速iaaS的部署、管理、配置
</code></pre>
<h2 id="cloudfoundry">
  CloudFoundry
  <a class="anchor" href="#cloudfoundry">#</a>
</h2>
<pre><code># pivotal开源, 根据应用模板，动态生成很多tomcat, mysql, nosql, 动态控制这些实例的启停。
</code></pre>
<h2 id="openstack">
  OpenStack
  <a class="anchor" href="#openstack">#</a>
</h2>
<pre><code># 云操作系统，管理虚拟资源
</code></pre>
<h1 id="container-orchestration">
  Container Orchestration
  <a class="anchor" href="#container-orchestration">#</a>
</h1>
<table>
  <thead>
      <tr>
          <th style="text-align: left">特性</th>
          <th style="text-align: left">dubbo</th>
          <th style="text-align: left">spring cloud</th>
          <th style="text-align: left">kubernetes</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">配置管理</td>
          <td style="text-align: left">-</td>
          <td style="text-align: left">config</td>
          <td style="text-align: left">kubernetes configMap</td>
      </tr>
      <tr>
          <td style="text-align: left">服务发现</td>
          <td style="text-align: left">zookeeper</td>
          <td style="text-align: left">eureka, consul, zookeeper</td>
          <td style="text-align: left">kubernetes services</td>
      </tr>
      <tr>
          <td style="text-align: left">负载均衡</td>
          <td style="text-align: left">自带</td>
          <td style="text-align: left">ribbon</td>
          <td style="text-align: left">kubernetes services</td>
      </tr>
      <tr>
          <td style="text-align: left">网关</td>
          <td style="text-align: left">-</td>
          <td style="text-align: left">zuul</td>
          <td style="text-align: left">kubernetes services</td>
      </tr>
      <tr>
          <td style="text-align: left">分布式追踪</td>
          <td style="text-align: left">-</td>
          <td style="text-align: left">spring cloud sleuth</td>
          <td style="text-align: left">open tracing</td>
      </tr>
      <tr>
          <td style="text-align: left">容错</td>
          <td style="text-align: left">不完善</td>
          <td style="text-align: left">hystrix</td>
          <td style="text-align: left">kubernetes health check</td>
      </tr>
      <tr>
          <td style="text-align: left">通信方式</td>
          <td style="text-align: left">rpc</td>
          <td style="text-align: left">http, message</td>
          <td></td>
      </tr>
      <tr>
          <td style="text-align: left">安全模块</td>
          <td style="text-align: left">-</td>
          <td style="text-align: left">spring cloud security</td>
          <td style="text-align: left">-</td>
      </tr>
      <tr>
          <td style="text-align: left">分布式日志</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">ELK</td>
          <td style="text-align: left">EFK</td>
      </tr>
      <tr>
          <td style="text-align: left">任务管理</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">spring batch</td>
          <td style="text-align: left">kubernetes jobs</td>
      </tr>
  </tbody>
</table>
<h2 id="kubernetes">
  Kubernetes
  <a class="anchor" href="#kubernetes">#</a>
</h2>
<pre><code># google开源的，borg的发展，在docker技术上，管理容器化应用
特点
    不限语言
    无侵入, 服务只写业务
    适合微服务                       # 调整服务副本数, 横向扩容
    无缝迁移到公有云                  # cluster ip实现不改配置迁移
    自动化资源管理
        服务发现，用dns解析服务名
        内嵌负载均衡
        部署实施
        治理
        监控
        故障发现、自我修复
        透明服务注册、发现
        服务滚动升级、在线扩容, 根据负载自动扩容缩容
        可扩展资源自动调度、多粒度资源配额
    多层安全防护、准入
    多租户
    完善的工具

    pod运行容器
    etcd保存所有状态
架构
    cluster
        master
            api server              # 对外http rest接口, 管理资源对象(pod, RC, service)增删改查
            controller manager      # 管理控制器, node, pod, endpoint, namespace, serviceAccount, resourceQuota自动化管理
            scheduler               # 接收controller manager命令执行pod调度
            etcd                    # 配置
        node                        # 一master多node
            特点
                node宕机，pod调度到其它节点
            pod                     # 一node几百个pod, 基本操作单元，代表一个运行进程，内部封装一个(或多个紧密相关的)容器。
                特点
                    pod内通信高效，放密切相关服务进程
                    可以判断一组相关容器的状态(用pause)
                    pause解决共享ip、容器通信、共享文件的问题
                    pod间通信用虚拟二层协议(flannel, openvswitch)实现
                    普通pod在etcd存储，再调度到某node实例化，静态pod在node中存储，在node实例化
                    对pod可进行资源(cpu,内存)限额
                label               # 标签，用标签选择器选择。key和value由用户指定，可附加到node, pod, service, rc等
                pause容器            # 根容器，共享网络栈、挂载卷
            docker/rocket           # 容器
            kubelet                 # master监视pod, 创建、修改、监控、删除
            kube-proxy              # 代理pod接口
            fluentd                 # 日志收集、存储、查询
            kube-dns                # 服务dns解析
概念
    service                         # 服务网关
        特点
            唯一名字
            唯一虚拟ip(cluster ip, service ip, vip)                  # 可多端口，每端口有名字
            提供远程服务              # 目前socket
            应用到一组pod
    event                           # 探针检测失败记录，用于排查故障
    rc                              # replication controller
        副本数
        筛选标签
        pod模板
        改变pod镜像版本，滚动升级
    replica set                     # 1.2 rc升级, 支持基于集合的标签选择。被deployment使用
    deployment                      # pod编排, rc升级
        特点
            查看pod部署进度
    HPA                             # horizontal pod autoscaler, 自动扩容缩容
        指标
            cpu utilization percentage                              # 1分钟内利用率平均值
            应用自定义指标(tps, qps)
    volume
        emptyDir
        hostPath
        gcePersistentDisk
        awsElasticBlockStore
        NFS
        persistent volume
        namespace
        annotation
动作
    扩容
        创建rc自动创建pod, 调度到合适的node
            pod定义
            副本数
            监控label                # 筛选pod得到数量
命令
    kubectl
        --help                      # 帮助, 各命令之后都可加
        version
        cluster-info
        logs
            kubectl logs --tail=1000 appID1
                # 查看日志
        run
        exec
            kubectl exec -it appID1 /bin/sh
                # 交互命令进入app
        create
            -f mysql-rc.yaml        # 创建rc
            -f mysql-svc.yaml       # 创建service
        set 
            image
        get
            rc                      # 查看rc
            pods
            pod
                -o
                    wide            # 显示详情，有node name
                o-&gt;
                kubectl get pod -l app=app1 -o wide
                    # 查看pod app状态
            services
            svc                     # 查看service, 包含cluster ip
            nodes
            endpoints               # service pod的ip:端口
            deployments
        describe                    # 详情
            node
            pods
            deployments
        expose
        label
        delete
        scale                       # pod扩容或缩容
            --replicas=2
        autoscale                   # 创建hpa对象
            deployment
        rolling-update              # pod滚动升级
        rollout
            status
            undo
        apply                       # 应用配置
            -f
        proxy
    kubelet
    kube-apiserver
    kube-proxy
    kube-scheduler
    kubeadm
    kube-controller-manager
    hyperkube
    apiextensions-apiserver
    mounter
镜像
    kube-apiserver
    kube-controller-manager
    kube-scheduler
    kube-proxy
    pause
    etcd
    coredns
配置
    用yaml或json定义
    pod
        kind: Pod                   # 表明是Pod
        metadata:
            name: myweb             # pod名
            labels:
                name: myweb         # 标签
</code></pre>
<h2 id="spring-cloud">
  Spring Cloud
  <a class="anchor" href="#spring-cloud">#</a>
</h2>
<h2 id="mesos">
  Mesos
  <a class="anchor" href="#mesos">#</a>
</h2>
<pre><code># twitter, apache开源的分布式资源管理框架, 两级调度器
</code></pre>
<h2 id="dubbo">
  Dubbo
  <a class="anchor" href="#dubbo">#</a>
</h2>
<pre><code>介绍
    阿里开源，分布式服务框架，rpc方案，soa治理
功能
    远程通讯    # 多协议，多种长连接nio框架封装
    集群容错    # 负载均衡，容错，地址路由，动态配置
    自动发现    # 注册中心
节点
    容器(container)
    提供者(provider)
    消费者(consumer)
    注册中心(registry)
    监控中心(monitor)
    调用关系
        容器启动提供者
        提供者注册
        消费者订阅
        注册中心返回地址列表, 长连接更新
        消费者软负载均衡挑选列表中提供者
        提供者和消费者累计调用次数和时间，定时发送到监控中心
容错机制
    failover    # 默认，失败自动切换
    failfast    # 立即报错，用于幂等写操作
    failsafe    # 忽略
    failback    # 定时重发
    forking     # 并行多个取最快(any)
    broadcast   # 逐个多个，异常退出
连接方式
    广播      # 不需要中心节点，适用开发测试, 地址段224.0.0.0 - 239.255.255.255
        服务端配置 applicationContext-service.xml
            &lt;dubbo:application name=”taotao-manager-service” /&gt;
            &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;
            &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” ref=”testServiceImpl” /&gt;
        客户端配置 springMVC.xml
            &lt;dubbp:application name=”taotao-manager-web” /&gt;
            &lt;dubbo:registry address=”multicast://224.5.6.7:1234” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” id=”testService”
            timeout=”10000000” /&gt;
    直连
        服务端配置
            &lt;dubbo:application name=”taotao-manager-service” /&gt;
            &lt;dubbo:registry address=”N/A” /&gt;
            &lt;dubbo:protocol name=”dubbo” port=”20880” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” ref=”testServiceImpl” /&gt; applicationContext-service.xml
        客户端配置 springMVC.xml
            &lt;dubbp:application name=”taotao-manager-web” /&gt;
            &lt;dubbo:service interface=”com.taotao.manager.service.TestService” id=”testService”
            timeout=”10000000” /&gt;
注册中心
    zookeeper
</code></pre>
<h2 id="dubbox">
  Dubbox
  <a class="anchor" href="#dubbox">#</a>
</h2>
<pre><code>介绍
    当当网扩展Dubbo
</code></pre>
<h2 id="netflix-oss">
  Netflix OSS
  <a class="anchor" href="#netflix-oss">#</a>
</h2>
<h2 id="orleans">
  orleans
  <a class="anchor" href="#orleans">#</a>
</h2>
<pre><code># .NET
</code></pre>
<h2 id="hsf">
  HSF
  <a class="anchor" href="#hsf">#</a>
</h2>
<pre><code># high-speed service framework, 阿里出品， socket直连
特点
    不增加中间点(稳定，高度可伸缩)
结构
    注册服务信息，推送服务地址
    基于osgi
组件
    服务提供者
    消费者
    地址服务器
    配置服务器               # 分布式配置
    规则服务(diamond)       # 设置(黑白名单，认证，权重，限流)与推送
</code></pre>
<h2 id="nscale">
  NScale
  <a class="anchor" href="#nscale">#</a>
</h2>
<pre><code># 可扩展容器，用node.js和docker实现
</code></pre>
<h2 id="armada">
  Armada
  <a class="anchor" href="#armada">#</a>
</h2>
<pre><code># python微服务
</code></pre>
<h1 id="soa">
  SOA
  <a class="anchor" href="#soa">#</a>
</h1>
<pre><code># 面向服务架构 service oriented architecture
</code></pre>
<h2 id="eai">
  EAI
  <a class="anchor" href="#eai">#</a>
</h2>
<pre><code># Enterprise Application Integration 建立底层结构将异构应用集成
</code></pre>
<h2 id="esb">
  ESB
  <a class="anchor" href="#esb">#</a>
</h2>
<pre><code># Enterprise Service Bus 企业服务总线， 是连接中枢
</code></pre>
<h1 id="rpc">
  RPC
  <a class="anchor" href="#rpc">#</a>
</h1>
<pre><code># 远程过程调用 remote procedure call
</code></pre>
<h2 id="thrift">
  Thrift
  <a class="anchor" href="#thrift">#</a>
</h2>
<h2 id="cxf">
  CXF
  <a class="anchor" href="#cxf">#</a>
</h2>
<pre><code>常识
    自己内部整合spring(但是不耦合)
支持的协议
    soap1.1/1.2
    post/http
    restful
    http
使用
    导入cxf包
    方法1      # 不支持注解
        String address=&quot;http://localhost:8888/hello&quot;;
            ServerFactoryBean factoryBean=new ServerFactoryBean();
            factoryBean.setAddress(address);
            factoryBean.setServiceBean(new MyWS());
            factoryBean.create();
    方法2      # 支持注解,wsdl文件中类型不再单独schema文件
        ServerFactoryBean factoryBean = new JaxWsServerFactoryBean      # java and xml web service
    日志    # 记录握手信息(访问wsdl文件)
            ## 看日志记录得到 soap
        serverFactoryBean.getInInterceptors().add(new LoggingInInterceptor());
        serverFactoryBean.getOutInterceptors().add(new LoggingOutInterceptor());
整合spring
    o-&gt; cxf2.4.4.jar/schemas/jaxws.xsd中找到命名空间&quot;http://cxf.apache.org/jaxws&quot;
    o-&gt; 配置applicationContext.xml，加入cxf的命名空间http://cxf.apache.org/jaxws,schema地址为http://cxf.apache.org/schemas/jaxws.xsd。
        并且在eclipse中配置schema约束文件的路径
            # 该xsd约束文件的url地址用的是包地址,不规范
    o-&gt; applicationContext.xml中配置
        &lt;bean id=&quot;studentService&quot; class=&quot;test.spring.StudentServiceImpl&quot;/&gt;
            # 用于：自身调用，被spring引用
        &lt;jaxws:server serviceClass=&quot;test.spring.StudentService&quot; address=&quot;/student&quot;&gt;
            # address配置服务的名称即可(web.xml的servlet中配置了服务的实际访问地址)
            ## serviceClass配置的才是真正的服务，既然它是接口，那么webService注解也应该写在接口上
            &lt;jaxws:serviceBean&gt;
                &lt;ref bean=&quot;studentService&quot;/&gt;
            &lt;jaxws:inInterceptors&gt;
                &lt;bean class=&quot;org.apache.cxf.interceptor.LoggingInInterceptor&quot; /&gt;
            &lt;jaxws:outInterceptors&gt;
                &lt;bean class=&quot;org.apache.cxf.interceptor.LoggingOutInterceptor&quot; /&gt;
    o-&gt; web.xml中配置servlet
         &lt;servlet&gt;
              &lt;servlet-name&gt;springWS
              &lt;servlet-class&gt;org.apache.cxf.transport.servlet.CXFServlet        # 在cxf-2.4.4.jar包中
              &lt;load-on-startup&gt;1
         &lt;servlet-mapping&gt;
              &lt;servlet-name&gt;springWS
              &lt;url-pattern&gt;/ws/*
    o-&gt; web.xml中配置spring监听器
</code></pre>
<h2 id="grpc">
  GRPC
  <a class="anchor" href="#grpc">#</a>
</h2>
<h2 id="protobuf">
  Protobuf
  <a class="anchor" href="#protobuf">#</a>
</h2>
<pre><code># 通信协议
命令
    protoc -I. -I-I$GOPATH/src  --go_out=plugins=grpc:. *
        # -I import目录
    protoc --grpc-gateway_out=.
插件
    安装
        # go build 出protoc-gen-go后，放入go/bin下
    protoc-gen-go
        # 编译proto文件
    protoc-gen-grpc-gateway
        # http服务
</code></pre>
<h1 id="rmi">
  RMI
  <a class="anchor" href="#rmi">#</a>
</h1>
<pre><code># java远程调用 remote method invocation
</code></pre>
<h2 id="hessian">
  Hessian
  <a class="anchor" href="#hessian">#</a>
</h2>
<pre><code># 是caucho公司的开源协议,基于http
</code></pre>
<h2 id="burlap">
  Burlap
  <a class="anchor" href="#burlap">#</a>
</h2>
<pre><code># caucho公房的开源协议,基于http
</code></pre>
<h2 id="httpinvoker">
  HttpInvoker
  <a class="anchor" href="#httpinvoker">#</a>
</h2>
<pre><code># spring提供的协议，必须用spring
</code></pre>
<h2 id="web-service">
  Web Service
  <a class="anchor" href="#web-service">#</a>
</h2>
<pre><code># soap通讯
</code></pre>
<h1 id="粘合层">
  粘合层
  <a class="anchor" href="#%e7%b2%98%e5%90%88%e5%b1%82">#</a>
</h1>
<h2 id="治理服务发现">
  治理(服务发现)
  <a class="anchor" href="#%e6%b2%bb%e7%90%86%e6%9c%8d%e5%8a%a1%e5%8f%91%e7%8e%b0">#</a>
</h2>
<h3 id="zookeeper">
  Zookeeper
  <a class="anchor" href="#zookeeper">#</a>
</h3>
<pre><code>介绍
    google chubby的开源实现。用于服务发现
    保证CP
    分布式, hadoop中hbase的组件
    fast paxos算法        # paxos存在活锁问题, fast paxos通过选举产生leader, 只有leader才能提交proposer
功能
    配置维护
    域名服务
    分布式同步
    组服务
    分布式独享锁、选举、队列
流程
    选举leader        # 多种算法, leader有最高执行ID
    同步数据
    大多数机器得到响应follow leader
exhibitor
    # supervisor for zk
</code></pre>
<h3 id="eureka">
  Eureka
  <a class="anchor" href="#eureka">#</a>
</h3>
<pre><code># Netflix，保证AP
</code></pre>
<h3 id="consul">
  Consul
  <a class="anchor" href="#consul">#</a>
</h3>
<pre><code># Apache，保证CA
</code></pre>
<h3 id="etcd">
  Etcd
  <a class="anchor" href="#etcd">#</a>
</h3>
<pre><code># kubernetes用，保证CP
</code></pre>
<h2 id="路由控制">
  路由控制
  <a class="anchor" href="#%e8%b7%af%e7%94%b1%e6%8e%a7%e5%88%b6">#</a>
</h2>
<pre><code>负载均衡策略
    随机、轮询、调用延迟判断、一致性哈希、粘滞连接
本地路由优先策略
    优先JVM（injvm），优先相同物理机（innative）
配置方式
    统一注册表、本地配置、动态下发
</code></pre>
<h2 id="配置">
  配置
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae">#</a>
</h2>
<h3 id="spring-cloud-config">
  Spring Cloud Config
  <a class="anchor" href="#spring-cloud-config">#</a>
</h3>
<h3 id="diamond">
  Diamond
  <a class="anchor" href="#diamond">#</a>
</h3>
<pre><code># 淘宝
</code></pre>
<h3 id="archaius">
  Archaius
  <a class="anchor" href="#archaius">#</a>
</h3>
<pre><code># netflix
</code></pre>
<h3 id="disconf">
  Disconf
  <a class="anchor" href="#disconf">#</a>
</h3>
<pre><code># 百度
</code></pre>
<h3 id="qconf">
  QConf
  <a class="anchor" href="#qconf">#</a>
</h3>
<pre><code># 360
</code></pre>
<h2 id="任务">
  任务
  <a class="anchor" href="#%e4%bb%bb%e5%8a%a1">#</a>
</h2>
<h3 id="elastic-job">
  Elastic-Job
  <a class="anchor" href="#elastic-job">#</a>
</h3>
<pre><code># 当当网
</code></pre>
<h3 id="azkaban">
  Azkaban
  <a class="anchor" href="#azkaban">#</a>
</h3>
<pre><code># linkedin
</code></pre>
<h3 id="spring-cloud-task">
  Spring Cloud Task
  <a class="anchor" href="#spring-cloud-task">#</a>
</h3>
<h2 id="跟踪">
  跟踪
  <a class="anchor" href="#%e8%b7%9f%e8%b8%aa">#</a>
</h2>
<h3 id="zipkin">
  zipkin
  <a class="anchor" href="#zipkin">#</a>
</h3>
<pre><code># twitter
</code></pre>
<h3 id="opentracing">
  Opentracing
  <a class="anchor" href="#opentracing">#</a>
</h3>
<h3 id="hydra">
  Hydra
  <a class="anchor" href="#hydra">#</a>
</h3>
<pre><code># 京东
</code></pre>
<h3 id="spring-cloud-sleuth">
  Spring Cloud Sleuth
  <a class="anchor" href="#spring-cloud-sleuth">#</a>
</h3>
<h2 id="监控">
  监控
  <a class="anchor" href="#%e7%9b%91%e6%8e%a7">#</a>
</h2>
<h3 id="spyjs">
  Spy.js
  <a class="anchor" href="#spyjs">#</a>
</h3>
<pre><code># webstorm用的监控工具
</code></pre>
<h3 id="alinode">
  Alinode
  <a class="anchor" href="#alinode">#</a>
</h3>
<pre><code># 朴灵写的运行时性能管理工具
</code></pre>
<h3 id="oneapm">
  OneAPM
  <a class="anchor" href="#oneapm">#</a>
</h3>
<pre><code># 监控node性能
功能
    接口响应时间
    数据库方法时间
    外部服务时间
    单请求的耗时比
</code></pre>
<h2 id="容错">
  容错
  <a class="anchor" href="#%e5%ae%b9%e9%94%99">#</a>
</h2>
<h3 id="hystrix">
  Hystrix
  <a class="anchor" href="#hystrix">#</a>
</h3>
<pre><code>功能
    服务线程隔离、信号量隔离
    降级: 超时、资源不足
    熔断: 自动降级、快速恢复
    请求缓存、请求合并
</code></pre>
<h2 id="代理">
  代理
  <a class="anchor" href="#%e4%bb%a3%e7%90%86">#</a>
</h2>
<h3 id="gearman">
  Gearman
  <a class="anchor" href="#gearman">#</a>
</h3>
<pre><code># 分布式计算, 把工作委派给其他机器
</code></pre>
<h3 id="hazelcast">
  Hazelcast
  <a class="anchor" href="#hazelcast">#</a>
</h3>
<pre><code># 基于内存的数据网格，用于分布式计算
</code></pre>
<h3 id="twemproxy">
  Twemproxy
  <a class="anchor" href="#twemproxy">#</a>
</h3>
<pre><code>redis/memcache分片代理
</code></pre>
<h1 id="高可用">
  高可用
  <a class="anchor" href="#%e9%ab%98%e5%8f%af%e7%94%a8">#</a>
</h1>
<pre><code># high-availability linux
目标
    reliability: 可靠性
    availability: 可用性
    serviceability: 可服务性
        ras: remote access service(远程服务访问)
术语
    节点(node): 唯一主节点，多个备用节点
    资源(resource): 是节点可控制的实体，主节点发生故障时，可以被其它节点接管
        例如:
            磁盘分区
            文件系统
            ip地址
            应用程序服务
            nfs文件系统
    事件(event): 集群中可能发生的事件
        例如:
            系统故障
            网络连通故障
            网卡故障
            应用程序故障
    动作(action): 事件发生时ha的响应方式
        例如: 用shell 脚本对资源进行转移
</code></pre>
<h2 id="心跳">
  心跳
  <a class="anchor" href="#%e5%bf%83%e8%b7%b3">#</a>
</h2>
<h3 id="heartbeat">
  HeartBeat
  <a class="anchor" href="#heartbeat">#</a>
</h3>
<pre><code>2.0模块
    heartbeat: 节点间通信检测模块
    ha-logd: 集群事件日志服务
    CCM(Consensus CLuster Membership): 集群成员一致性管理模块
    LRM(Local Resource Manager): 本地资源管理模块
    Stonith Daemon: 使出现问题的节点从集群资源中脱离
    CRM(Cluster Resource management): 集群资源管理模块
    Cluster policy engine: 集群策略引擎
            用于实现节点与资源之间的管理与依赖关系
    Cluster transition  engine: 集群转移引擎

3.0拆分之后的组成部分
    Heartbeat: 负责节点之间的通信
    Cluster Glue: 中间层，关联Heartbeat 与 Pacemaker,包含LRM 与 stonith
    Resource Agent: 控制服务启停，监控服务状态脚本集合，被LRM调用
    Pacemaker: 也就是曾经的CRM，包含了更多的功能
        管理接口:
            crm shell
            一个使用ajax web 的web窗口
            hb_gui图形工具
            DRBD-MC, 一个基于java的工具

版本差异
    与1.x相比，2.1.x版本变化
        保留原来所有功能
        自动监控资源
        对各资源组进行独立监控
        同时监控系统负载
            自动切换到负载低的node上
</code></pre>
<h3 id="keepalived">
  Keepalived
  <a class="anchor" href="#keepalived">#</a>
</h3>
<pre><code>vrrp
    # virtual router redundancy protocol 虚拟路由器冗余协议
    # 解决静态路由出现的闪单点故障问题，它能够保证网络的不间断．稳定运行
</code></pre>
<h2 id="负载">
  负载
  <a class="anchor" href="#%e8%b4%9f%e8%bd%bd">#</a>
</h2>
<pre><code># load balance
方法
        dns轮循

        java nio
        erlang语言
        linux epoll
        bsd kqueue
        消息队列、事件通知
        c/c++下ace, boost.asio, libev(libevent)
        服务器mina, jetty, node.js, netty
        java协程框架 quasar kilim
</code></pre>
<h3 id="haproxy">
  Haproxy
  <a class="anchor" href="#haproxy">#</a>
</h3>
<pre><code>监控页面
        /status
</code></pre>
<h3 id="tengine">
  Tengine
  <a class="anchor" href="#tengine">#</a>
</h3>
<pre><code># 淘宝基于nginx修改，添加了功能
监控
    /upstream_status
</code></pre>
<h3 id="openresty">
  OpenResty
  <a class="anchor" href="#openresty">#</a>
</h3>
<pre><code># 淘宝改的nginx, lua工具
安装
    yum install -y gcc gcc-c++ kernel-devel readline-devel pcre-devel openssl-devel openssl zlib zlib-devel pcre-devel
    wget openresty-1.9.15.1.tar.gz
    ./configure --prefix=/opt/openresty --with-pcre-jit --with-ipv6 --without-http_redis2_module --with-http_iconv_module -j2
    make &amp;&amp; make install
    ln -s /opt/openresty/nginx/sbin/nginx /usr/sbin
    /opt/openresty/nginx/conf/nginx.conf
</code></pre>
<h3 id="varnish">
  Varnish
  <a class="anchor" href="#varnish">#</a>
</h3>
<pre><code># 反向代理, http缓存
</code></pre>
<h3 id="traffic-server">
  Traffic Server
  <a class="anchor" href="#traffic-server">#</a>
</h3>
<pre><code># apache 缓存
</code></pre>
<h3 id="squid">
  Squid
  <a class="anchor" href="#squid">#</a>
</h3>
<pre><code>配置文件
    /etc/squid/squid.conf
代理类型
    普通代理
    透明代理
    反向代理
缓存
    动态资源
    静态资源
参考资料
    squid 透明代理详解
配置
    # squid.conf
    http_port 3128                                                # squid服务端口
    icp_port 3130                                                # udp端口,用来接收和发送ICP消息
    cache_dir ufs /var/spool/squid                                # 缓存目录, 写入方式有aufs与ufs两种,aufs使用大量线程异步进行磁盘i/o操作
    cache_access_log /var/log/squid/access.log
    cache_log /var/log/squid/cache.log
    cache_store_log /var/log/squid/store.log
    pid_filename /var/run/squid.pid                        # 日志文件位置

    #auth_param basic children 5
    #auth_param basic realm Squid proxy-caching web server
    #auth_param basic credentialsttl 2 hours                 # 关闭认证，认证一般不需要

    cache_effective_user squid
    cache_effective_group squid
    cache_mgr youraccount@your.e.mail                        # 设置squid用户及用户组、管理员账号

    cache_mem 128 MB                                        # 运行内存配置

    cache_swap_low 90
    cache_swap_high 95
    maximum_object_size 4096 KB                        ＃ 与磁盘容量相关的配置，90、95为百分比，磁盘大时4096 KB可以改成32768 KB

    maximum_object_size_in_memory 8 KB                ＃ 内存缓存资料大小

    以下为定义acl(访问控制列表)
            ＃ 语法为:acl&lt;acl&gt; &lt;acl名称&gt; &lt;acl类型&gt; &lt;配置的内容&gt;
    acl All src 0/0
    acl Manager proto cache_object  acl Localhost src 127.0.0.1/32
    acl Safe_ports port 80 21 443 563 70 210 280 488 591 777 1025-65535
    acl SSL_ports 443 563
    acl CONNECT method CONNECT
    acl MyNetwork src 192.168.0.0/16

    以下为利用前面定义的acl,定义访问控制规则
    http_access allow Manager Localhost
    http_access deny Manager
    http_access deny !Safe_ports
    http_access deny CONNECT SSL_ports
    http_access allow MyNetwork
    http_access deny All

    例子: 禁止访问sina
    acl sina dstdomain .sina.com.cn .sina.com
    http_access deny sina
    或
    acl sina dst 58.63.236.26 58.63.236.27 58.63.236.28 58.63.236.29 58.63.236.30 58.63.236.31 58.63.236.32 58.63.236.33 58.63.236.34 58.63.236.35 58.63.236.36 58.63.236.37 58.63.236.38 58.63.236.39 58.63.236.49 58.63.236.50
    http_access deny sina
    或
    acl sina dst www.sina.com.cn
    http_access deny sina

    例子: 禁止来自某些ip的访问
    acl zhang src 192.168.63.6/32
    http_access deny zhang

    例子: 禁止在某些时段访问
    acl Working_hours MTWHF 08:00-17:00
    http_access allow Working_hours
    http_access deny !Working_hours

    例子: 禁止某个代理客户建立过多连接
    acl OverConnLimit maxconn
    http_access deny OverConnLimit

    定义与其它代理服务器的关系,语法: &lt;cache_peer&gt; &lt;主机名称&gt; &lt;类别&gt; &lt;http_port&gt; &lt;icp_port&gt; &lt;其它参数&gt;
    cache_peer 192.168.60.6 parent 4480 7 no-query default

    #设置与其它代理服务器的关系: &lt;cache_peer_access&gt; &lt;上层 Proxy &gt; &lt;allow|deny&gt; &lt;acl名称&gt;
    #cache_peer_access 192.168.60.6 allow aclxxx
    #cache_peer_access 192.168.60.6 deny !aclxxx
    coredump_dir /var/spool/squid                                        # 崩溃存储目录
使用
    step1 检查配置文件
        squid -k parse
    step2  初始化cache 目录
        squid -z(X)                                # X会显示过程
    step3 启动squid
        service squid start
        或
        /usr/local/squid/sbin/squid -sD
    停止squid
        squid -k shutdown
    重新载入配置
        squid -k reconfigure
    滚动日志
        squid -k rotate
案例
    透明代理
        step1 检查配置文件
            squid -k parse
        step2  初始化cache 目录
            squid -z(X)                                # X会显示过程
        step3 启动squid
            service squid start
            或
            /usr/local/squid/sbin/squid -sD
        停止squid
            squid -k shutdown
        重新载入配置
            squid -k reconfigure
        滚动日志
            squid -k rotate
    代理
        squid.conf
            http_port 3128
            http_access allow all
            或
            http_port 3128
            http_access deny all前面添加
            acl 192.168.0.42 src 192.168.0.0/24
            http_access allow 192.168.0.42                        ＃ 192.168.0.42为允许的ip
</code></pre>
<h3 id="lvs">
  LVS
  <a class="anchor" href="#lvs">#</a>
</h3>
<pre><code>介绍
    第四层开始负载(可以建立到三层负载)

    第四层负载
        socket进必须连lvs

模式
    tun
        # lvs负载均衡器将请求包发给物理服务器，后者将应答包直接发给用户
    net
        # 请求和应答都经过lvs
    dr
        # 不要隧道结构的tun
使用
    DR模式 centos6
    yum install-y gcc gcc-c++ makepcre pcre-devel kernel-devel openssl-devel libnl-devel popt-devel
    modprobe -l |grep ipvs
        # 检查内核是否集成
    echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward
        # 开启路由转发
    安装ipvsadm
        http://www.linuxvirtualserver.org/software/kernel-2.6/ipvsadm-1.26.tar.gz
    安装keepalived
        http://www.keepalived.org/software/keepalived-1.2.7.tar.gz
        ./configure --prefix=/usr/local/keepalived

        cp  /usr/local/keepalived/etc/rc.d/init.d/keepalived        /etc/init.d/
        cp /usr/local/keepalived/etc/sysconfig/keepalived        /etc/sysconfig/
        mkdir /etc/keepalived/
        cp /usr/local/keepalived/etc/keepalived/keepalived.conf        /etc/keepalived/
        cp /usr/local/keepalived/sbin/keepalived        /usr/sbin/

        o-&gt; 配置文件/etc/keepalived/keepalived.conf
        ! Configuration File forkeepalived
        global_defs {
        notification_email {
        test@sina.com    #故障接受联系人
        }
        notification_email_from admin@test.com  #故障发送人
        smtp_server 127.0.0.1  #本机发送邮件
        smtp_connect_timeout 30
        router_id LVS_MASTER  #BACKUP上修改为LVS_BACKUP
        }
        vrrp_instance VI_1 {
        state MASTER    #BACKUP上修改为BACKUP
        interface eth0
        virtual_router_id 51  #虚拟路由标识，主从相同
        priority 100  #BACKUP上修改为90
        advert_int 1
        authentication {
        auth_type PASS
        auth_pass 1111  #主从认证密码必须一致
        }
        virtual_ipaddress {    #Web虚拟IP（VTP）
        172.0.0.10
        }
        }
        virtual_server 172.0.0.10 80 { #定义虚拟IP和端口
        delay_loop 6    #检查真实服务器时间，单位秒
        lb_algo rr      #设置负载调度算法，rr为轮训
        lb_kind DR      #设置LVS负载均衡DR模式
        persistence_timeout 50 #同一IP的连接60秒内被分配到同一台真实服务器
        protocol TCP    #使用TCP协议检查realserver状态
        real_server 172.0.0.13 80 {  #第一个web服务器
        weight 3          #节点权重值
        TCP_CHECK {      #健康检查方式
        connect_timeout 3 #连接超时
        nb_get_retry 3    #重试次数
        delay_before_retry 3  #重试间隔/S
        }
        }
        real_server 172.0.0.14 80 {  #第二个web服务器
        weight 3
        TCP_CHECK {
        connect_timeout 3
        nb_get_retry 3
        delay_before_retry 3
            }
        }
        }

        service keepalived restart

    启动脚本 /etc/init.d/real.sh
        #description : start realserver
        VIP=172.0.0.10
        . /etc/init.d/functions
        case &quot;$1&quot; in
        start)
        /sbin/ifconfig lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up
        echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore
        echo &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce
        echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore
        echo &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_announce
        echo &quot;LVS RealServer Start OK&quot;
        ;;
        stop)
        /sbin/ifconfig lo:0 down
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore
        echo &quot;0&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_announce
        echo &quot;LVS RealServer Stoped OK&quot;
        ;;
        *)
        echo &quot;Usage: $0 {start|stop}&quot;
        exit 1
        esac

    o-&gt; 开机启动
        chmod +x /etc/init.d/real.sh
        /etc/init.d/real.sh start
        echo &quot;/etc/init.d/real.sh start&quot; &gt;&gt; /etc/rc.local
    o-&gt; 测试
        service httpd start
        echo &quot;1&quot; &gt; /var/www/html/index.html
        service iptables stop
        setenforce 0
            # 关闭selinux
    o-&gt; 其他命令
        ipvsadm -ln
            # 集群中服务器ip信息
        ip addr
            # 显示VIP当前绑定的服务器
        tail -f /var/log/messages
            # 日志
</code></pre>
<h1 id="数据库">
  数据库
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93">#</a>
</h1>
<h2 id="读写分离">
  读写分离
  <a class="anchor" href="#%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb">#</a>
</h2>
<pre><code>MySQL主从复制
Haproxy + 多Slave
DRBD + Heartbeat + MySQL
MySQL Cluster
</code></pre>
<h2 id="分片">
  分片
  <a class="anchor" href="#%e5%88%86%e7%89%87">#</a>
</h2>
<pre><code>问题
    事务
    Join
    迁移
    扩容
    ID生成
    分页
方案
    事务补偿        # 数据对账：基于日志对比、同步标准数据源
    分区            # MySQL机制分文件存储，客户端无感知
    分表            # 客户端管理分表路由
    分库
        为什么 
            单库无法承接连接数时分库，MySQL单库5千万条，Oracle单库一亿条
        策略
            数值范围
            取模
            日期
框架
    Sharding-JDBC
    TSharding
代理
    Atlas
    MyCAT
    Vitess
</code></pre>
<h2 id="分布式文件系统">
  分布式文件系统
  <a class="anchor" href="#%e5%88%86%e5%b8%83%e5%bc%8f%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f">#</a>
</h2>
<pre><code>HDFS            # 批量读写，高吞吐量，不适合小文件
FastDFS         # 轻量级，适合小文件
</code></pre>
<h1 id="一致性">
  一致性
  <a class="anchor" href="#%e4%b8%80%e8%87%b4%e6%80%a7">#</a>
</h1>
<pre><code>CAP
    一致性
        强一致性、弱一致性（秒级），最终一致性
    可用性
    分区容错性（网络故障）
BASE
    Basically Available（基本可用），Soft state（软状态），Eventually consistent（最终一致性）
幂等性
</code></pre>
<h2 id="分布式锁">
  分布式锁
  <a class="anchor" href="#%e5%88%86%e5%b8%83%e5%bc%8f%e9%94%81">#</a>
</h2>
<pre><code>算法
    PAXOS
    Zab
        # Zookeeper使用
    Raft
        # 三角色：Leader（领袖），Follower（群众），Candidtate（候选人）
    Gossip
        # Cassandra使用
实现方式
    数据库
        有单点问题
    缓存
        非阻塞性能好
        有锁不释放问题
        实现
            RedLock setnx
            Memcached add
    Zookeeper
        有序临时节点，集群透明解决单点问题，锁被释放，锁可重入
        性能不如缓存，吞吐量随集群规模变大而下降
</code></pre>
<h2 id="一致性哈希">
  一致性哈希
  <a class="anchor" href="#%e4%b8%80%e8%87%b4%e6%80%a7%e5%93%88%e5%b8%8c">#</a>
</h2>
<pre><code>扩容映射
</code></pre>
<h2 id="分布式事务">
  分布式事务
  <a class="anchor" href="#%e5%88%86%e5%b8%83%e5%bc%8f%e4%ba%8b%e5%8a%a1">#</a>
</h2>
<pre><code>分类
    两阶段提交、多阶段提交
    TCC事务
</code></pre>
<h3 id="atomikos">
  Atomikos
  <a class="anchor" href="#atomikos">#</a>
</h3>
<h1 id="id生成器">
  ID生成器
  <a class="anchor" href="#id%e7%94%9f%e6%88%90%e5%99%a8">#</a>
</h1>
<pre><code>Snowflake算法           # Twitter
    41位时间戳+10位机器标识（比如IP，服务器名称等）+12位序列号(本地计数器)
MySQL自增ID + &quot;REPLACE INTO XXX:SELECT LAST_INSERT_ID();&quot;
    # Flicker
MongoDB ObjectId
    不能自增
UUID
    无序，过长，影响检索性能
</code></pre>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/outrunJ/hugo-blog/commit/9d2ea756f7e5d3ffd8c443f52554888da5999c1a" title='Last modified by outrunJ | Apr 23, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>Apr 23, 2022</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/outrunJ/hugo-blog/tree/master/content/content/docs/middleware/distributed/_index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#名词">名词</a></li>
    <li><a href="#serverless">Serverless</a></li>
    <li><a href="#servicemesh">ServiceMesh</a>
      <ul>
        <li><a href="#service-fabric">Service Fabric</a></li>
        <li><a href="#istio">Istio</a></li>
        <li><a href="#knative">Knative</a></li>
        <li><a href="#traefik">Traefik</a></li>
        <li><a href="#linkerd">Linkerd</a></li>
        <li><a href="#conduit">Conduit</a></li>
        <li><a href="#fingle">Fingle</a></li>
        <li><a href="#envoy">Envoy</a></li>
        <li><a href="#nginmesh">Nginmesh</a></li>
      </ul>
    </li>
    <li><a href="#paas">PaaS</a>
      <ul>
        <li><a href="#cloudstack">CloudStack</a></li>
        <li><a href="#cloudfoundry">CloudFoundry</a></li>
        <li><a href="#openstack">OpenStack</a></li>
      </ul>
    </li>
    <li><a href="#container-orchestration">Container Orchestration</a>
      <ul>
        <li><a href="#kubernetes">Kubernetes</a></li>
        <li><a href="#spring-cloud">Spring Cloud</a></li>
        <li><a href="#mesos">Mesos</a></li>
        <li><a href="#dubbo">Dubbo</a></li>
        <li><a href="#dubbox">Dubbox</a></li>
        <li><a href="#netflix-oss">Netflix OSS</a></li>
        <li><a href="#orleans">orleans</a></li>
        <li><a href="#hsf">HSF</a></li>
        <li><a href="#nscale">NScale</a></li>
        <li><a href="#armada">Armada</a></li>
      </ul>
    </li>
    <li><a href="#soa">SOA</a>
      <ul>
        <li><a href="#eai">EAI</a></li>
        <li><a href="#esb">ESB</a></li>
      </ul>
    </li>
    <li><a href="#rpc">RPC</a>
      <ul>
        <li><a href="#thrift">Thrift</a></li>
        <li><a href="#cxf">CXF</a></li>
        <li><a href="#grpc">GRPC</a></li>
        <li><a href="#protobuf">Protobuf</a></li>
      </ul>
    </li>
    <li><a href="#rmi">RMI</a>
      <ul>
        <li><a href="#hessian">Hessian</a></li>
        <li><a href="#burlap">Burlap</a></li>
        <li><a href="#httpinvoker">HttpInvoker</a></li>
        <li><a href="#web-service">Web Service</a></li>
      </ul>
    </li>
    <li><a href="#粘合层">粘合层</a>
      <ul>
        <li><a href="#治理服务发现">治理(服务发现)</a>
          <ul>
            <li><a href="#zookeeper">Zookeeper</a></li>
            <li><a href="#eureka">Eureka</a></li>
            <li><a href="#consul">Consul</a></li>
            <li><a href="#etcd">Etcd</a></li>
          </ul>
        </li>
        <li><a href="#路由控制">路由控制</a></li>
        <li><a href="#配置">配置</a>
          <ul>
            <li><a href="#spring-cloud-config">Spring Cloud Config</a></li>
            <li><a href="#diamond">Diamond</a></li>
            <li><a href="#archaius">Archaius</a></li>
            <li><a href="#disconf">Disconf</a></li>
            <li><a href="#qconf">QConf</a></li>
          </ul>
        </li>
        <li><a href="#任务">任务</a>
          <ul>
            <li><a href="#elastic-job">Elastic-Job</a></li>
            <li><a href="#azkaban">Azkaban</a></li>
            <li><a href="#spring-cloud-task">Spring Cloud Task</a></li>
          </ul>
        </li>
        <li><a href="#跟踪">跟踪</a>
          <ul>
            <li><a href="#zipkin">zipkin</a></li>
            <li><a href="#opentracing">Opentracing</a></li>
            <li><a href="#hydra">Hydra</a></li>
            <li><a href="#spring-cloud-sleuth">Spring Cloud Sleuth</a></li>
          </ul>
        </li>
        <li><a href="#监控">监控</a>
          <ul>
            <li><a href="#spyjs">Spy.js</a></li>
            <li><a href="#alinode">Alinode</a></li>
            <li><a href="#oneapm">OneAPM</a></li>
          </ul>
        </li>
        <li><a href="#容错">容错</a>
          <ul>
            <li><a href="#hystrix">Hystrix</a></li>
          </ul>
        </li>
        <li><a href="#代理">代理</a>
          <ul>
            <li><a href="#gearman">Gearman</a></li>
            <li><a href="#hazelcast">Hazelcast</a></li>
            <li><a href="#twemproxy">Twemproxy</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#高可用">高可用</a>
      <ul>
        <li><a href="#心跳">心跳</a>
          <ul>
            <li><a href="#heartbeat">HeartBeat</a></li>
            <li><a href="#keepalived">Keepalived</a></li>
          </ul>
        </li>
        <li><a href="#负载">负载</a>
          <ul>
            <li><a href="#haproxy">Haproxy</a></li>
            <li><a href="#tengine">Tengine</a></li>
            <li><a href="#openresty">OpenResty</a></li>
            <li><a href="#varnish">Varnish</a></li>
            <li><a href="#traffic-server">Traffic Server</a></li>
            <li><a href="#squid">Squid</a></li>
            <li><a href="#lvs">LVS</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据库">数据库</a>
      <ul>
        <li><a href="#读写分离">读写分离</a></li>
        <li><a href="#分片">分片</a></li>
        <li><a href="#分布式文件系统">分布式文件系统</a></li>
      </ul>
    </li>
    <li><a href="#一致性">一致性</a>
      <ul>
        <li><a href="#分布式锁">分布式锁</a></li>
        <li><a href="#一致性哈希">一致性哈希</a></li>
        <li><a href="#分布式事务">分布式事务</a>
          <ul>
            <li><a href="#atomikos">Atomikos</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#id生成器">ID生成器</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












